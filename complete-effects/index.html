<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:inherit;font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);border-left-color:inherit;opacity:0.8;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0, 0%, 0%, 0.2);;border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"â€” ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#d23669;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}a.anchor{box-shadow:none;}a.anchor svg[aria-hidden="true"]{stroke:#d23669;}p code{font-size:1rem;}h1 code, h2 code, h3 code, h4 code, h5 code, h6 code{font-size:inherit;}li code{font-size:1rem;}blockquote.translation{font-size:1em;}</style><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=07fab8ad5473f1e15e5f98b64f5d02eda19b8316"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="shortcut icon" href="/icons/icon-48x48.png?v=07fab8ad5473f1e15e5f98b64f5d02eda19b8316"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=07fab8ad5473f1e15e5f98b64f5d02eda19b8316"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=07fab8ad5473f1e15e5f98b64f5d02eda19b8316"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=07fab8ad5473f1e15e5f98b64f5d02eda19b8316"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=07fab8ad5473f1e15e5f98b64f5d02eda19b8316"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=07fab8ad5473f1e15e5f98b64f5d02eda19b8316"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=07fab8ad5473f1e15e5f98b64f5d02eda19b8316"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=07fab8ad5473f1e15e5f98b64f5d02eda19b8316"/><meta name="generator" content="Gatsby 2.1.37"/><title data-react-helmet="true">ä¸€ä»½å®Œæ•´çš„effectsæŒ‡å— | xiaohesong&#x27;s Blog</title><meta data-react-helmet="true" name="description" content="è¯¦ç»†çš„ä»‹ç»äº†effectsä½¿ç”¨ä¸­çš„ä¸€äº›ç»†èŠ‚"/><meta data-react-helmet="true" property="og:title" content="ä¸€ä»½å®Œæ•´çš„effectsæŒ‡å—"/><meta data-react-helmet="true" property="og:description" content="è¯¦ç»†çš„ä»‹ç»äº†effectsä½¿ç”¨ä¸­çš„ä¸€äº›ç»†èŠ‚"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="xiaohesong"/><meta data-react-helmet="true" name="twitter:title" content="ä¸€ä»½å®Œæ•´çš„effectsæŒ‡å—"/><meta data-react-helmet="true" name="twitter:description" content="è¯¦ç»†çš„ä»‹ç»äº†effectsä½¿ç”¨ä¸­çš„ä¸€äº›ç»†èŠ‚"/><style data-href="/styles.a14d302f9ca31b4b2b96.css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-4124805c0503dbfe42dd67d7f5715964.woff2) format("woff2"),url(/static/montserrat-latin-100-c8fb2f714bbc7bc3e8dfffa916b286dc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-e4bf47bd171a9b2a72dd84c58bf90edf.woff2) format("woff2"),url(/static/montserrat-latin-100italic-d1f3f2d02ee4d7d2d4b1ad865014f189.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-444ae007121264bc1969d49b4031f9b2.woff2) format("woff2"),url(/static/montserrat-latin-200-edbce16a90aa22c297a0307b85789837.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-f316c5d1ec40f3e68654c3f38b3999f3.woff2) format("woff2"),url(/static/montserrat-latin-200italic-d7bbb730d9b5e11720b3eb32326dcca7.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-0a7c6df06e85d978d096d4d18fd8d43d.woff2) format("woff2"),url(/static/montserrat-latin-300-5e86df2cad22d2ef2b03516334afae5e.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-c076c4892bc7a4be7b9097e97a35012d.woff2) format("woff2"),url(/static/montserrat-latin-300italic-37c74a8d2d0d36a0a2c6e9a37ee15b0c.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-501ce09c42716a2f6e1503a25eb174c9.woff2) format("woff2"),url(/static/montserrat-latin-400-f29d2b8559699b6beb5b29b25b8bc572.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-882908d9950d9c86ebd380877f293d95.woff2) format("woff2"),url(/static/montserrat-latin-400italic-22e7b04e5f2a901d49d4d342315a715a.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-f0f2716c5fe401d175b88715e7d28685.woff2) format("woff2"),url(/static/montserrat-latin-500-991b453bf90a0980e78966d2af7e3d3a.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-4590ebba421b3288c305305d7fa7b504.woff2) format("woff2"),url(/static/montserrat-latin-500italic-f3d41e4cdcc2314e49ddcea751d6f87f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-15c24f7109941777774ddd2c636c6a50.woff2) format("woff2"),url(/static/montserrat-latin-600-f6dc6096f48956908c1787d9a722570a.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-6d10b80529d5c36c7c09fca7193af0fc.woff2) format("woff2"),url(/static/montserrat-latin-600italic-02c4833312d94b1b0866f073023a250e.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-79982cd1f74c6fa7451bf9b37ead09ff.woff2) format("woff2"),url(/static/montserrat-latin-700-957e93fbbe131a59791cd820d98b7109.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-283438e9577fe6a684466bb100e105ec.woff2) format("woff2"),url(/static/montserrat-latin-700italic-ca627c5ccc65cf80c2ecaea44b997de9.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-35386154b78d046218fc8f88a44ff515.woff2) format("woff2"),url(/static/montserrat-latin-800-756655905d91b77960888262e7d58d35.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-e1b52a7bd83e2324db6d92bdc206844c.woff2) format("woff2"),url(/static/montserrat-latin-800italic-a69f0add9d86c1a84311d7dd8693ba4a.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-260c2ea3ef57feb82251952e605a36d5.woff2) format("woff2"),url(/static/montserrat-latin-900-186cae8091da578150d81958e217714a.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-d785fb9fc74588ffb7f306799709a97d.woff2) format("woff2"),url(/static/montserrat-latin-900italic-43b527fe77254f97ea36e2b54e845ec4.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}body{--pink:#ffa7c4;background-color:var(--bg)}body.light{--bg:#fff;--header:var(--pink);--textNormal:#222;--textTitle:#222;--textLink:#d23669;--hr:rgba(0,0,0,0.2);--inlineCode-bg:rgba(255,229,100,0.2);--inlineCode-text:#1a1a1a}body.dark{-webkit-font-smoothing:antialiased;--bg:#282c35;--header:#fff;--textNormal:hsla(0,0%,100%,0.88);--textTitle:#fff;--textLink:var(--pink);--hr:hsla(0,0%,100%,0.2);--inlineCode-bg:#373c49;--inlineCode-text:#e6e6e6}code[class*=language-],pre[class*=language-]{color:#fff;background:none;font-family:Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;-webkit-font-feature-settings:normal;font-feature-settings:normal;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;margin-bottom:0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{overflow:auto;padding:1em}pre[class*=language-]::selection{background:#27292a}pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:hsla(0,0%,100%,.15)}:not(pre)>code[class*=language-]{border-radius:.3em;background:rgba(255,229,100,.2);color:#1a1a1a;padding:.15em .2em .05em;white-space:normal}.token.attr-name{color:#addb67;font-style:italic}.token.comment{color:#637777}.token.string,.token.url{color:#addb67}.token.variable{color:#d6deeb}.token.number{color:#f78c6c}.token.builtin,.token.char,.token.constant,.token.function{color:#82aaff}.token.punctuation{color:#c792ea}.token.inserted{color:#ffa7c4}.token.doctype,.token.selector{color:#c792ea;font-style:"italic"}.token.class-name{color:#ffcb8b}.token.keyword,.token.operator,.token.tag{color:#ffa7c4}.token.boolean{color:#ff5874}.token.property{color:#80cbc4}.token.namespace{color:#b2ccd6}pre[data-line]{padding:1em 0 1em 3em;position:relative}.gatsby-highlight-code-line{background-color:#022a4b;display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:.75em;border-left:.25em solid #ffa7c4}.gatsby-highlight{margin-bottom:1.75rem;border-radius:10px;background:#011627;-webkit-overflow-scrolling:touch;overflow:auto}.gatsby-highlight pre[class*=language-]{float:left;min-width:100%}@font-face{font-family:octicons-link;src:url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAAAZwABAAAAAACFQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEU0lHAAAGaAAAAAgAAAAIAAAAAUdTVUIAAAZcAAAACgAAAAoAAQAAT1MvMgAAAyQAAABJAAAAYFYEU3RjbWFwAAADcAAAAEUAAACAAJThvmN2dCAAAATkAAAABAAAAAQAAAAAZnBnbQAAA7gAAACyAAABCUM+8IhnYXNwAAAGTAAAABAAAAAQABoAI2dseWYAAAFsAAABPAAAAZwcEq9taGVhZAAAAsgAAAA0AAAANgh4a91oaGVhAAADCAAAABoAAAAkCA8DRGhtdHgAAAL8AAAADAAAAAwGAACfbG9jYQAAAsAAAAAIAAAACABiATBtYXhwAAACqAAAABgAAAAgAA8ASm5hbWUAAAToAAABQgAAAlXu73sOcG9zdAAABiwAAAAeAAAAME3QpOBwcmVwAAAEbAAAAHYAAAB/aFGpk3jaTY6xa8JAGMW/O62BDi0tJLYQincXEypYIiGJjSgHniQ6umTsUEyLm5BV6NDBP8Tpts6F0v+k/0an2i+itHDw3v2+9+DBKTzsJNnWJNTgHEy4BgG3EMI9DCEDOGEXzDADU5hBKMIgNPZqoD3SilVaXZCER3/I7AtxEJLtzzuZfI+VVkprxTlXShWKb3TBecG11rwoNlmmn1P2WYcJczl32etSpKnziC7lQyWe1smVPy/Lt7Kc+0vWY/gAgIIEqAN9we0pwKXreiMasxvabDQMM4riO+qxM2ogwDGOZTXxwxDiycQIcoYFBLj5K3EIaSctAq2kTYiw+ymhce7vwM9jSqO8JyVd5RH9gyTt2+J/yUmYlIR0s04n6+7Vm1ozezUeLEaUjhaDSuXHwVRgvLJn1tQ7xiuVv/ocTRF42mNgZGBgYGbwZOBiAAFGJBIMAAizAFoAAABiAGIAznjaY2BkYGAA4in8zwXi+W2+MjCzMIDApSwvXzC97Z4Ig8N/BxYGZgcgl52BCSQKAA3jCV8CAABfAAAAAAQAAEB42mNgZGBg4f3vACQZQABIMjKgAmYAKEgBXgAAeNpjYGY6wTiBgZWBg2kmUxoDA4MPhGZMYzBi1AHygVLYQUCaawqDA4PChxhmh/8ODDEsvAwHgMKMIDnGL0x7gJQCAwMAJd4MFwAAAHjaY2BgYGaA4DAGRgYQkAHyGMF8NgYrIM3JIAGVYYDT+AEjAwuDFpBmA9KMDEwMCh9i/v8H8sH0/4dQc1iAmAkALaUKLgAAAHjaTY9LDsIgEIbtgqHUPpDi3gPoBVyRTmTddOmqTXThEXqrob2gQ1FjwpDvfwCBdmdXC5AVKFu3e5MfNFJ29KTQT48Ob9/lqYwOGZxeUelN2U2R6+cArgtCJpauW7UQBqnFkUsjAY/kOU1cP+DAgvxwn1chZDwUbd6CFimGXwzwF6tPbFIcjEl+vvmM/byA48e6tWrKArm4ZJlCbdsrxksL1AwWn/yBSJKpYbq8AXaaTb8AAHja28jAwOC00ZrBeQNDQOWO//sdBBgYGRiYWYAEELEwMTE4uzo5Zzo5b2BxdnFOcALxNjA6b2ByTswC8jYwg0VlNuoCTWAMqNzMzsoK1rEhNqByEyerg5PMJlYuVueETKcd/89uBpnpvIEVomeHLoMsAAe1Id4AAAAAAAB42oWQT07CQBTGv0JBhagk7HQzKxca2sJCE1hDt4QF+9JOS0nbaaYDCQfwCJ7Au3AHj+LO13FMmm6cl7785vven0kBjHCBhfpYuNa5Ph1c0e2Xu3jEvWG7UdPDLZ4N92nOm+EBXuAbHmIMSRMs+4aUEd4Nd3CHD8NdvOLTsA2GL8M9PODbcL+hD7C1xoaHeLJSEao0FEW14ckxC+TU8TxvsY6X0eLPmRhry2WVioLpkrbp84LLQPGI7c6sOiUzpWIWS5GzlSgUzzLBSikOPFTOXqly7rqx0Z1Q5BAIoZBSFihQYQOOBEdkCOgXTOHA07HAGjGWiIjaPZNW13/+lm6S9FT7rLHFJ6fQbkATOG1j2OFMucKJJsxIVfQORl+9Jyda6Sl1dUYhSCm1dyClfoeDve4qMYdLEbfqHf3O/AdDumsjAAB42mNgYoAAZQYjBmyAGYQZmdhL8zLdDEydARfoAqIAAAABAAMABwAKABMAB///AA8AAQAAAAAAAAAAAAAAAAABAAAAAA==) format("woff")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .octicon{display:inline-block;vertical-align:text-top;fill:currentColor}.markdown-body a{background-color:transparent;-webkit-text-decoration-skip:objects}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body svg:not(:root){overflow:hidden}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:content-box;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px;font-weight:600}.markdown-body h2{font-size:24px;font-weight:600}.markdown-body h3{font-size:20px;font-weight:600}.markdown-body h4{font-size:16px;font-weight:600}.markdown-body h5{font-size:14px;font-weight:600}.markdown-body h6{font-size:12px;font-weight:600}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0;font:12px SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace}.markdown-body .octicon{vertical-align:text-bottom}.markdown-body .pl-0{padding-left:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .anchor{float:left;padding-right:4px;margin-left:-20px;line-height:1}.markdown-body .anchor:focus{outline:none}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body kbd{font-size:11px;border:1px solid #c6cbd1;border-bottom-color:#959da5;box-shadow:inset 0 -1px 0 #959da5}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:content-box;background-color:#fff}.markdown-body code{padding:.2em 0;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code:after,.markdown-body code:before{letter-spacing:-.2em;content:"\A0"}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}.markdown-body pre code:after,.markdown-body pre code:before{content:normal}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-bottom-color:#c6cbd1;border-radius:3px;box-shadow:inset 0 -1px 0 #c6cbd1}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}.markdown-body hr{border-bottom-color:#eee}.gt-container{font-size:16px}.gt-container,.gt-container *{box-sizing:border-box}.gt-container a{color:#6190e8}.gt-container a:hover{color:#81a6ed;border-color:#81a6ed}.gt-container a.is--active{color:#333;cursor:default!important}.gt-container a.is--active:hover{color:#333}.gt-container .hide{display:none!important}.gt-container .gt-svg{display:inline-block;width:1em;height:1em;vertical-align:sub}.gt-container .gt-svg svg{width:100%;height:100%;fill:#6190e8}.gt-container .gt-ico{display:inline-block}.gt-container .gt-ico-text{margin-left:.3125em}.gt-container .gt-ico-github,.gt-container .gt-ico-github .gt-svg{width:100%;height:100%}.gt-container .gt-ico-github svg{fill:inherit}.gt-container .gt-spinner{position:relative}.gt-container .gt-spinner:before{content:"";box-sizing:border-box;position:absolute;top:3px;width:.75em;height:.75em;margin-top:-.1875em;margin-left:-.375em;border-radius:50%;border:1px solid #fff;border-top-color:#6190e8;-webkit-animation:gt-kf-rotate .6s linear infinite;animation:gt-kf-rotate .6s linear infinite}.gt-container .gt-loader{position:relative;border:1px solid #999;-webkit-animation:gt-kf-rotate 1.5s ease infinite;animation:gt-kf-rotate 1.5s ease infinite;display:inline-block;font-style:normal;width:1.75em;height:1.75em;line-height:1.75em;border-radius:50%}.gt-container .gt-loader:before{content:"";position:absolute;display:block;top:0;left:50%;margin-top:-.1875em;margin-left:-.1875em;width:.375em;height:.375em;background-color:#999;border-radius:50%}.gt-container .gt-avatar{display:inline-block;width:3.125em;height:3.125em}@media (max-width:479px){.gt-container .gt-avatar{width:2em;height:2em}}.gt-container .gt-avatar img{width:100%;height:auto;border-radius:3px}.gt-container .gt-avatar-github{width:3em;height:3em}@media (max-width:479px){.gt-container .gt-avatar-github{width:1.875em;height:1.875em}}.gt-container .gt-btn{padding:.75em 1.25em;display:inline-block;line-height:1;text-decoration:none;white-space:nowrap;cursor:pointer;border:1px solid #6190e8;border-radius:5px;background-color:#6190e8;color:#fff;outline:none;font-size:.75em}.gt-container .gt-btn-text{font-weight:400}.gt-container .gt-btn-loading{position:relative;margin-left:.5em;display:inline-block;width:.75em;height:1em;vertical-align:top}.gt-container .gt-btn.is--disable{cursor:not-allowed;opacity:.5}.gt-container .gt-btn-login{margin-right:0}.gt-container .gt-btn-preview{background-color:#fff;color:#6190e8}.gt-container .gt-btn-preview:hover{background-color:#f2f2f2;border-color:#81a6ed}.gt-container .gt-btn-public:hover{background-color:#81a6ed;border-color:#81a6ed}.gt-container .gt-error{text-align:center;margin:.625em;color:#ff3860}.gt-container .gt-initing{padding:1.25em 0;text-align:center}.gt-container .gt-initing-text{margin:.625em auto;font-size:92%}.gt-container .gt-no-init{padding:1.25em 0;text-align:center}.gt-container .gt-link{border-bottom:1px dotted #6190e8}.gt-container .gt-link-counts,.gt-container .gt-link-project{text-decoration:none}.gt-container .gt-meta{margin:1.25em 0;padding:1em 0;border-bottom:1px solid #e9e9e9;font-size:1em;position:relative;z-index:10}.gt-container .gt-meta:after,.gt-container .gt-meta:before{content:" ";display:table}.gt-container .gt-meta:after{clear:both}.gt-container .gt-counts{margin:0 .625em 0 0}.gt-container .gt-user{float:right;margin:0;font-size:92%}.gt-container .gt-user-pic{width:16px;height:16px;vertical-align:top;margin-right:.5em}.gt-container .gt-user-inner{display:inline-block;cursor:pointer}.gt-container .gt-user .gt-ico{margin:0 0 0 .3125em}.gt-container .gt-user .gt-ico svg{fill:inherit}.gt-container .gt-user .is--poping .gt-ico svg{fill:#6190e8}.gt-container .gt-version{color:#a1a1a1;margin-left:.375em}.gt-container .gt-copyright{margin:0 .9375em .5em;border-top:1px solid #e9e9e9;padding-top:.5em}.gt-container .gt-popup{position:absolute;right:0;top:2.375em;background:#fff;display:inline-block;border:1px solid #e9e9e9;padding:.625em 0;font-size:.875em;letter-spacing:.5px}.gt-container .gt-popup .gt-action{cursor:pointer;display:block;margin:.5em 0;padding:0 1.125em;position:relative;text-decoration:none}.gt-container .gt-popup .gt-action.is--active:before{content:"";width:.25em;height:.25em;background:#6190e8;position:absolute;left:.5em;top:.4375em}.gt-container .gt-header{position:relative;display:-webkit-flex;display:flex}.gt-container .gt-header-comment{-webkit-flex:1 1;flex:1 1;margin-left:1.25em}@media (max-width:479px){.gt-container .gt-header-comment{margin-left:.875em}}.gt-container .gt-header-textarea{padding:.75em;display:block;box-sizing:border-box;width:100%;min-height:5.125em;max-height:15em;border-radius:5px;border:1px solid rgba(0,0,0,.1);font-size:.875em;word-wrap:break-word;resize:vertical;background-color:#f6f6f6;outline:none;transition:all .25s ease}.gt-container .gt-header-textarea:hover{background-color:#fbfbfb}.gt-container .gt-header-preview{padding:.75em;border-radius:5px;border:1px solid rgba(0,0,0,.1);background-color:#f6f6f6}.gt-container .gt-header-controls{position:relative;margin:.75em 0 0}.gt-container .gt-header-controls:after,.gt-container .gt-header-controls:before{content:" ";display:table}.gt-container .gt-header-controls:after{clear:both}@media (max-width:479px){.gt-container .gt-header-controls{margin:0}}.gt-container .gt-header-controls-tip{font-size:.875em;color:#6190e8;text-decoration:none;vertical-align:sub}@media (max-width:479px){.gt-container .gt-header-controls-tip{display:none}}.gt-container .gt-header-controls .gt-btn{float:right;margin-left:1.25em}@media (max-width:479px){.gt-container .gt-header-controls .gt-btn{float:none;width:100%;margin:.75em 0 0}}.gt-container:after{content:"";position:fixed;bottom:100%;left:0;right:0;top:0;opacity:0}.gt-container.gt-input-focused{position:relative}.gt-container.gt-input-focused:after{content:"";position:fixed;bottom:0;left:0;right:0;top:0;background:#000;opacity:.6;transition:opacity .3s,bottom 0s;z-index:9999}.gt-container.gt-input-focused .gt-header-comment{z-index:10000}.gt-container .gt-comments{padding-top:1.25em}.gt-container .gt-comments-null{text-align:center}.gt-container .gt-comments-controls{margin:1.25em 0;text-align:center}.gt-container .gt-comment{position:relative;padding:.625em 0;display:-webkit-flex;display:flex}.gt-container .gt-comment-content{-webkit-flex:1 1;flex:1 1;margin-left:1.25em;padding:.75em 1em;background-color:#f9f9f9;overflow:auto;transition:all .25s ease}.gt-container .gt-comment-content:hover{box-shadow:0 .625em 3.75em 0 #f4f4f4}@media (max-width:479px){.gt-container .gt-comment-content{margin-left:.875em;padding:.625em .75em}}.gt-container .gt-comment-header{margin-bottom:.5em;font-size:.875em;position:relative}.gt-container .gt-comment-username{font-weight:500;color:#6190e8;text-decoration:none}.gt-container .gt-comment-username:hover{text-decoration:underline}.gt-container .gt-comment-date,.gt-container .gt-comment-text{margin-left:.5em;color:#a1a1a1}.gt-container .gt-comment-edit,.gt-container .gt-comment-like,.gt-container .gt-comment-reply{position:absolute;height:1.375em}.gt-container .gt-comment-edit:hover,.gt-container .gt-comment-like:hover,.gt-container .gt-comment-reply:hover{cursor:pointer}.gt-container .gt-comment-like{top:0;right:2em}.gt-container .gt-comment-edit,.gt-container .gt-comment-reply{top:0;right:0}.gt-container .gt-comment-body{color:#333!important}.gt-container .gt-comment-admin .gt-comment-content{background-color:#f6f9fe}@-webkit-keyframes gt-kf-rotate{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes gt-kf-rotate{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}</style><link as="script" rel="preload" href="/styles-60fd549bc9ab6b221310.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-96d8df3c717df691c5f4.js"/><link as="script" rel="preload" href="/9-4a5ba2240e899672ff06.js"/><link as="script" rel="preload" href="/1-1e22823bb50faf851faf.js"/><link as="script" rel="preload" href="/app-2d0306e8e3d3d5f3a6aa.js"/><link as="script" rel="preload" href="/webpack-runtime-7cce248b055c448b772c.js"/><link as="fetch" rel="preload" href="/static/d/981/path---complete-effects-a-30-eec-QSOVuHO2ZAG6i2S7DoHCPiVsesI.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header><h3 style="font-family:Montserrat, sans-serif;margin-top:0"><a style="box-shadow:none;text-decoration:none;color:rgb(255, 167, 196)" href="/">xiaohesong&#x27;s Blog</a></h3></header><main><h1>ä¸€ä»½å®Œæ•´çš„effectsæŒ‡å—</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem;margin-top:-1.75rem">March 27, 2019</p><div><p>ä½ ä½¿ç”¨<a href="https://github.com/xiaohesong/TIL/blob/master/front-end/react/hooks/intro.md" target="_blank" rel="nofollow noopener noreferrer">hooks</a>å†™äº†ä¸€äº›ç»„ä»¶ã€‚ä¹Ÿè®¸åªæ˜¯ä¸€ä¸ªå°çš„åº”ç”¨ã€‚ä½ åŸºæœ¬ä¸Šå¯¹è¿™äº›æ˜¯æ»¡æ„çš„ã€‚ä½ å¯¹APIä¹Ÿæ¸¸åˆƒæœ‰ä½™ï¼Œå¹¶åœ¨æ­¤è¿‡ç¨‹ä¸­å­¦ä¼šäº†ä¸€äº›æŠ€å·§ã€‚ä½ ç”šè‡³åšäº†ä¸€äº›<a href="https://github.com/xiaohesong/TIL/blob/master/front-end/react/hooks/custom-hook.md" target="_blank" rel="nofollow noopener noreferrer">è‡ªå®šä¹‰Hook</a>æ¥æå–é‡å¤é€»è¾‘ï¼ˆ300è¡Œä»£ç æ¶ˆå¤±äº†ï¼ï¼‰å¹¶å‘ä½ çš„åŒäº‹å±•ç¤ºäº†å®ƒã€‚ä»–ä»¬ä¼šè¯´ï¼Œâ€œå¹²å¾—å¥½â€ã€‚</p>
<p>ä½†æ˜¯æœ‰æ—¶å€™å½“ä½ ä½¿ç”¨<code class="language-text">useEffect</code>çš„æ—¶å€™ï¼Œæœ‰äº›éƒ¨åˆ†å¹¶ä¸å®Œå…¨åˆé€‚ã€‚ä½ æœ‰ä¸€ç§æŒ¥ä¹‹ä¸å»çš„æ„Ÿè§‰ï¼Œè§‰å¾—è‡ªå·±é”™è¿‡äº†ä»€ä¹ˆã€‚å®ƒä¼¼ä¹ä¸ç±»ç”Ÿå‘½å‘¨æœŸç›¸ä¼¼â€¦ä½†å®ƒçœŸçš„å¦‚æ­¤å—ï¼Ÿä½ å‘ç°è‡ªå·±ä¼šé—®è¿™æ ·çš„é—®é¢˜ï¼š</p>
<ul>
<li>ğŸ¤” å¦‚ä½•ä½¿ç”¨<code class="language-text">useEffect</code>æ›¿ä»£<code class="language-text">componentDidMount</code>ï¼Ÿ</li>
<li>ğŸ¤” å¦‚ä½•åœ¨<code class="language-text">useEffect</code>ä¸­æ­£ç¡®çš„è·å–æ•°æ®ï¼Ÿ<code class="language-text">[]</code>æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>ğŸ¤” æˆ‘æ˜¯å¦éœ€è¦å°†å‡½æ•°æŒ‡å®šä¸ºæ•ˆæœ(effect)ä¾èµ–é¡¹?</li>
<li>ğŸ¤” ä¸ºä»€ä¹ˆæœ‰æ—¶ä¼šå¾—åˆ°ä¸€ä¸ªæ— é™é‡å¤è·å–å¾ªç¯?</li>
<li>ğŸ¤” ä¸ºä»€ä¹ˆæˆ‘æœ‰æ—¶ä¼šåœ¨æ•ˆæœ(effect)ä¸­è·å¾—æ—§çš„çŠ¶æ€æˆ–propå€¼ï¼Ÿ</li>
</ul>
<p>å½“æˆ‘åˆšåˆšå¼€å§‹ä½¿ç”¨Hooksæ—¶ï¼Œæˆ‘ä¹Ÿå¯¹æ‰€æœ‰è¿™äº›é—®é¢˜æ„Ÿåˆ°å›°æƒ‘ã€‚å³ä½¿åœ¨å†™æœ€åˆçš„æ–‡æ¡£æ—¶ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰å¯¹å…¶ä¸­çš„ä¸€äº›ç»†èŠ‚æœ‰ä¸€ä¸ªå¾ˆå¥½çš„æŠŠæ¡ã€‚ä»é‚£ä»¥åï¼Œæˆ‘æœ‰ä¸€äº›â€œå•Šå“ˆâ€(è±ç„¶å¼€æœ—)çš„æ—¶åˆ»ï¼Œæˆ‘æƒ³å’Œä½ ä»¬åˆ†äº«ã€‚<strong>è¿™ä¸ªçš„æ·±å…¥ç ”ç©¶å°†ä½¿è¿™äº›é—®é¢˜çš„ç­”æ¡ˆå¯¹ä½ æ¥è¯´æ˜¾è€Œæ˜“è§ã€‚</strong> </p>
<p>ä¸ºäº†<em>çœ‹</em> åˆ°ç­”æ¡ˆï¼Œæˆ‘ä»¬éœ€è¦åé€€ä¸€æ­¥ã€‚æœ¬æ–‡çš„ç›®çš„ä¸æ˜¯ç»™ä½ ä¸€ä¸ªæ–¹æ³•åˆ—è¡¨å»ç”¨ã€‚ä¸»è¦æ˜¯ä¸ºäº†å¸®åŠ©ä½ çœŸæ­£â€œç†è§£â€<code class="language-text">useEffect</code>ã€‚æ²¡æœ‰å¤ªå¤šè¦å­¦çš„ä¸œè¥¿ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬éœ€è¦èŠ±è´¹å¤§éƒ¨åˆ†æ—¶é—´å»å¿˜è®°å­¦ä¹ çš„ä¸œè¥¿(<em>unlearning</em>)ã€‚</p>
<p><strong>ç›´åˆ°æˆ‘ä¸å†é€šè¿‡ç†Ÿæ‚‰çš„ç±»ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æ¥çœ‹å¾…<code class="language-text">useEffect</code> Hookä¹‹å, è¿™ä¸€åˆ‡æ‰èä¼šè´¯é€šã€‚</strong> </p>
<blockquote>
<p>â€œå¿˜æ‰ä½ å­¦åˆ°çš„ä¸œè¥¿â€ã€‚â€” Yoda</p>
</blockquote>
<p><img src="https://overreacted.io/static/6203a1f1f2c771816a5ba0969baccd12/5ed8a/yoda.jpg"></p>
<hr>
<p><strong>æœ¬æ–‡å‡è®¾ä½ å¯¹<a href="https://github.com/xiaohesong/TIL/blob/master/front-end/react/hooks/effect-hook.md" target="_blank" rel="nofollow noopener noreferrer">useEffect</a>APIæœ‰ç‚¹ç†Ÿæ‚‰ã€‚</strong> </p>
<p><strong>æœ¬æ–‡çš„ç¡®å¾ˆé•¿ã€‚å°±åƒä¸€æœ¬è¿·ä½ å°ä¹¦ã€‚è¿™åªæ˜¯æˆ‘å–œæ¬¢çš„ç‰ˆå¼ã€‚ä½†æ˜¯å¦‚æœä½ å¾ˆå¿™æˆ–è€…ä¸åœ¨ä¹ï¼Œæˆ‘åœ¨ä¸‹é¢å†™äº†ä¸€ä¸ªTLDRä¾›ä½ å¿«é€Ÿäº†è§£ã€‚</strong></p>
<p><strong>å¦‚æœä½ å¯¹æ·±åº¦å­¦ä¹ ä¸æ€ä¹ˆå–œæ¬¢ï¼Œä½ å¯èƒ½æƒ³ç­‰åˆ°è¿™äº›è§£é‡Šå‡ºç°åœ¨å…¶ä»–åœ°æ–¹å†å­¦ä¹ ã€‚å°±åƒReactåœ¨2013å¹´æ¨å‡ºæ—¶ä¸€æ ·ï¼Œäººä»¬éœ€è¦ä¸€æ®µæ—¶é—´æ‰èƒ½è®¤è¯†åˆ°ä¸€ç§ä¸åŒçš„æ€ç»´æ¨¡å¼å¹¶è¿›è¡Œæ•™å­¦ã€‚</strong> </p>
<hr>
<h2 id="tldr"><a href="#tldr" aria-label="tldr permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>TLDR</h2>
<p>å¦‚æœä½ ä¸æƒ³é˜…è¯»æ•´ç¯‡æ–‡ç« ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå¿«é€Ÿçš„TLDRã€‚å¦‚æœæœ‰äº›éƒ¨åˆ†æ²¡æœ‰æ„ä¹‰ï¼Œå¯ä»¥å‘ä¸‹æ»šåŠ¨ï¼Œç›´åˆ°æ‰¾åˆ°ç›¸å…³çš„å†…å®¹ã€‚</p>
<p>å¦‚æœä½ æ‰“ç®—é˜…è¯»æ•´ç¯‡æ–‡ç« ï¼Œå¯ä»¥è·³è¿‡å®ƒã€‚æˆ‘ä¼šåœ¨æœ€åé“¾æ¥åˆ°å®ƒã€‚</p>
<p><strong>ğŸ¤” é—®é¢˜ï¼šå¦‚ä½•ä½¿ç”¨<code class="language-text">useEffect</code>æ›¿ä»£<code class="language-text">componentDidMount</code> ï¼Ÿ</strong></p>
<p>è™½ç„¶å¯ä»¥ç”¨<code class="language-text">useEffect(fn, [])</code>ï¼Œä½†å®ƒå¹¶ä¸æ˜¯å®Œå…¨ç­‰ä»·çš„ã€‚ä¸<code class="language-text">componentDidMount</code>ä¸åŒï¼Œå®ƒå°†<em>æ•è·(capture)</em> propså’ŒçŠ¶æ€ã€‚æ‰€ä»¥å³ä½¿åœ¨å›è°ƒä¸­ï¼Œä½ ä¹Ÿä¼šçœ‹åˆ°æœ€åˆçš„propså’ŒçŠ¶æ€ã€‚å¦‚æœä½ æƒ³çœ‹åˆ°â€œæœ€æ–°â€çš„ä¸œè¥¿ï¼Œä½ å¯ä»¥æŠŠå®ƒå†™åˆ°refã€‚ä½†æ˜¯é€šå¸¸æœ‰ä¸€ç§æ›´ç®€å•çš„æ–¹æ³•æ¥æ„é€ ä»£ç ï¼Œè¿™æ ·ä½ å°±ä¸å¿…è¿™æ ·åšäº†ã€‚è¯·è®°ä½ï¼Œæ•ˆæœ(effect)çš„å¿ƒç†æ¨¡å‹ä¸<code class="language-text">componentDidMount</code>å’Œå…¶ä»–ç”Ÿå‘½å‘¨æœŸä¸åŒï¼Œè¯•å›¾æ‰¾åˆ°å®ƒä»¬çš„ç¡®åˆ‡å¯¹ç­‰ç‰©å¯èƒ½ä¼šè®©ä½ æ„Ÿåˆ°å›°æƒ‘ï¼Œè€Œä¸æ˜¯æœ‰æ‰€å¸®åŠ©ã€‚ä¸ºäº†æé«˜æ•ˆç‡ï¼Œä½ éœ€è¦â€œæ€è€ƒæ•ˆæœâ€ï¼Œä»–ä»¬çš„å¿ƒæ™ºæ¨¡å‹æ›´æ¥è¿‘äºå®ç°åŒæ­¥ï¼Œè€Œä¸æ˜¯å“åº”ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚</p>
<p><strong>ğŸ¤” é—®é¢˜ï¼šå¦‚ä½•åœ¨<code class="language-text">useEffect</code>ä¸­æ­£ç¡®è·å–æ•°æ®ï¼Ÿä»€ä¹ˆæ˜¯ <code class="language-text">[]</code>ï¼Ÿ</strong></p>
<p><a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="nofollow noopener noreferrer">è¿™ç¯‡æ–‡ç« </a>æ˜¯ä½¿ç”¨<code class="language-text">useEffect</code>è¿›è¡Œæ•°æ®è·å–çš„ä¸€ä¸ªå¾ˆå¥½çš„å…¥é—¨è¯»ç‰©ã€‚ä¸€å®šè¦æŠŠå®ƒè¯»å®Œï¼å®ƒä¸åƒè¿™ä¸ªé‚£ä¹ˆé•¿ã€‚<code class="language-text">[]</code>è¡¨ç¤ºè¯¥æ•ˆæœä¸ä½¿ç”¨å‚ä¸Reactæ•°æ®æµçš„ä»»ä½•å€¼ï¼Œå› æ­¤å¯ä»¥å®‰å…¨åœ°åº”ç”¨ä¸€æ¬¡ã€‚å½“å®é™…ä½¿ç”¨è¯¥å€¼æ—¶ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¸¸è§çš„bugæºã€‚ä½ éœ€è¦å­¦ä¹ ä¸€äº›ç­–ç•¥(ä¸»è¦æ˜¯<code class="language-text">useReducer</code>å’Œ<code class="language-text">useCallback</code>)ï¼Œè¿™äº›ç­–ç•¥å¯ä»¥<em>æ¶ˆé™¤</em>å¯¹ä¾èµ–é¡¹çš„éœ€è¦ï¼Œè€Œä¸æ˜¯é”™è¯¯åœ°å¿½ç•¥å®ƒã€‚</p>
<p><strong>ğŸ¤” é—®é¢˜ï¼šæˆ‘æ˜¯å¦éœ€è¦å°†å‡½æ•°æŒ‡å®šä¸ºæ•ˆæœä¾èµ–é¡¹ï¼Ÿ</strong></p>
<p>å»ºè®®å°†ä¸éœ€è¦propsæˆ–çŠ¶æ€çš„å‡½æ•°æåˆ°ç»„ä»¶å¤–éƒ¨ï¼Œå¹¶å°†ä»…ç”±æ•ˆæœ<em>å†…éƒ¨</em>ä½¿ç”¨çš„å‡½æ•°æ‹‰å‡ºæ¥ä½¿ç”¨ã€‚å¦‚æœåœ¨æ­¤ä¹‹åï¼Œä½ çš„æ•ˆæœä»ç„¶ä½¿ç”¨æ¸²æŸ“èŒƒå›´ä¸­çš„å‡½æ•°(åŒ…æ‹¬æ¥è‡ªpropsçš„å‡½æ•°)ï¼Œé‚£ä¹ˆå°†å®ƒä»¬å°è£…åˆ°å®šä¹‰å®ƒä»¬çš„<code class="language-text">useCallback</code>ä¸­ï¼Œå¹¶é‡å¤è¯¥è¿‡ç¨‹ã€‚ä¸ºä»€ä¹ˆè¿™å¾ˆé‡è¦?å‡½æ•°å¯ä»¥â€œçœ‹åˆ°â€æ¥è‡ªpropså’ŒçŠ¶æ€çš„å€¼â€”â€”å› æ­¤å®ƒä»¬å‚ä¸æ•°æ®æµã€‚æˆ‘ä»¬çš„å¸¸è§é—®é¢˜è§£ç­”ä¸­æœ‰<a href="https://reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies" target="_blank" rel="nofollow noopener noreferrer">æ›´è¯¦ç»†çš„ç­”æ¡ˆ</a>ã€‚</p>
<p><strong>ğŸ¤” é—®é¢˜ï¼šä¸ºä»€ä¹ˆæœ‰æ—¶ä¼šå¾—åˆ°ä¸€ä¸ªæ— é™é‡å¤è·å–å¾ªç¯?</strong></p>
<p>å¦‚æœåœ¨æ²¡æœ‰ç¬¬äºŒä¸ªä¾èµ–é¡¹å‚æ•°çš„æƒ…å†µä¸‹åœ¨ä¸€ä¸ªæ•ˆæœä¸­æ‰§è¡Œæ•°æ®è·å–ï¼Œåˆ™å¯èƒ½ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚æ²¡æœ‰å®ƒï¼Œæ•ˆæœä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åè¿è¡Œ - è®¾ç½®çŠ¶æ€å°†å†æ¬¡è§¦å‘æ•ˆæœã€‚å¦‚æœæŒ‡å®šçš„è¿™ä¸ªå€¼<em>å§‹ç»ˆ</em>åœ¨ä¾èµ–å…³ç³»æ•°ç»„ä¸­æ”¹å˜ï¼Œä¹Ÿå¯èƒ½å‘ç”Ÿæ— é™å¾ªç¯ã€‚ä½ å¯ä»¥é€šè¿‡ä¸€ä¸ªä¸€ä¸ªåœ°æŠŠå®ƒä»¬ç§»é™¤æ¥è¾¨åˆ«æ˜¯å“ªä¸ªã€‚ä½†æ˜¯ï¼Œåˆ é™¤ä½ ä½¿ç”¨çš„ä¾èµ–é¡¹ï¼ˆæˆ–ç›²ç›®æŒ‡å®š<code class="language-text">[]</code>ï¼‰é€šå¸¸æ˜¯é”™è¯¯çš„ä¿®å¤ã€‚ç›¸åï¼Œä»æºå¤´è§£å†³é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå‡½æ•°å¯èƒ½ä¼šå¯¼è‡´è¿™ä¸ªé—®é¢˜ï¼Œå°†å®ƒä»¬æ”¾åœ¨æ•ˆæœä¸­ã€å°†å®ƒä»¬æå‡ºæ¥æˆ–ä½¿ç”¨<code class="language-text">useCallback</code>åŒ…è£…å®ƒä»¬ä¼šæœ‰æ‰€å¸®åŠ©ã€‚ä¸ºé¿å…é‡æ–°åˆ›å»ºå¯¹è±¡ï¼Œ<code class="language-text">useMemo</code>å¯ç”¨äºç±»ä¼¼ç›®çš„ã€‚</p>
<p><strong>ğŸ¤” ä¸ºä»€ä¹ˆæˆ‘æœ‰æ—¶ä¼šåœ¨æ•ˆæœä¸­è·å¾—æ—§çš„çŠ¶æ€æˆ–propså€¼ï¼Ÿ</strong></p>
<p>æ•ˆæœæ€»æ˜¯ä»å®šä¹‰çš„æ¸²æŸ“ä¸­â€œçœ‹åˆ°â€propså’ŒçŠ¶æ€ã€‚è¿™<a href="https://github.com/xiaohesong/TIL/blob/master/front-end/react/overreact/%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6%E4%B8%8E%E7%B1%BB%E6%9C%89%E4%BB%80%E4%B9%88%E4%B8%8D%E5%90%8C.md" target="_blank" rel="nofollow noopener noreferrer">æœ‰åŠ©äºé˜²æ­¢é”™è¯¯</a>ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šä»¤äººè®¨åŒã€‚å¯¹äºè¿™äº›æƒ…å†µï¼Œä½ å¯ä»¥æ˜¾å¼åœ°åœ¨å¯å˜refä¸­ç»´æŠ¤ä¸€äº›å€¼(é“¾æ¥é‡Œçš„æ–‡ç« åœ¨æœ€åå¯¹æ­¤è¿›è¡Œäº†è§£é‡Š)ã€‚å¦‚æœä½ è®¤ä¸ºä½ ä»æ—§çš„æ¸²æŸ“ä¸­çœ‹åˆ°äº†ä¸€äº›propsæˆ–çŠ¶æ€ï¼Œä½†å¹¶ä¸æ˜¯ä½ æœŸæœ›çš„ï¼Œé‚£ä¹ˆä½ å¯èƒ½é”™è¿‡äº†ä¸€äº›ä¾èµ–é¡¹ã€‚å°è¯•ä½¿ç”¨<a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="nofollow noopener noreferrer">lintè§„åˆ™</a>æ¥é”»ç‚¼è‡ªå·±å‘ç°å®ƒä»¬ã€‚è¿‡å‡ å¤©ï¼Œå®ƒå°±ä¼šæˆä¸ºä½ çš„ç¬¬äºŒå¤©æ€§ã€‚è¯·å‚é˜…å¸¸è§é—®é¢˜è§£ç­”ä¸­çš„<a href="https://reactjs.org/docs/hooks-faq.html#why-am-i-seeing-stale-props-or-state-inside-my-function" target="_blank" rel="nofollow noopener noreferrer">æ­¤ç­”æ¡ˆ</a>ã€‚</p>
<hr>
<p>æˆ‘å¸Œæœ›è¿™ä¸ªTLDRå¾ˆæœ‰å¸®åŠ©ï¼å¦åˆ™ï¼Œæˆ‘ä»¬ç»§ç»­å§ã€‚</p>
<h2 id="æ¯ä¸ªæ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„propså’ŒçŠ¶æ€"><a href="#%E6%AF%8F%E4%B8%AA%E6%B8%B2%E6%9F%93%E9%83%BD%E6%9C%89%E8%87%AA%E5%B7%B1%E7%9A%84props%E5%92%8C%E7%8A%B6%E6%80%81" aria-label="æ¯ä¸ªæ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„propså’ŒçŠ¶æ€ permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æ¯ä¸ªæ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„propså’ŒçŠ¶æ€</h2>
<p>åœ¨æˆ‘ä»¬è°ˆè®ºæ•ˆæœä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è®¨è®ºæ¸²æŸ“ã€‚</p>
<p>è¿™æ˜¯ä¸€ä¸ªcounterã€‚ä»”ç»†æŸ¥çœ‹çªå‡ºæ˜¾ç¤ºçš„è¡Œï¼š</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="gatsby-highlight-code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">        Click me</span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>è¿™æ˜¯ä»€ä¹ˆæ„æ€?æ˜¯å¦<code class="language-text">count</code>ä»¥æŸç§æ–¹å¼â€œç›‘è§†â€çŠ¶æ€çš„æ›´æ”¹å¹¶è‡ªåŠ¨æ›´æ–°? å½“ä½ å­¦ä¹ Reactæ—¶ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„ç¬¬ä¸€ç›´è§‰ï¼Œä½†å®ƒä¸æ˜¯ä¸€ä¸ªå‡†ç¡®çš„<a href="https://github.com/xiaohesong/TIL/blob/master/front-end/react/overreact/react%E4%BD%9C%E4%B8%BAui%E8%BF%90%E8%A1%8C.md" target="_blank" rel="nofollow noopener noreferrer">å¿ƒç†æ¨¡å‹</a>ã€‚</p>
<p><strong>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ<code class="language-text">count</code>åªæ˜¯ä¸€ä¸ªæ•°å­—ã€‚</strong> å®ƒä¸æ˜¯ç¥å¥‡çš„â€œæ•°æ®ç»‘å®šâ€ï¼Œâ€œè§‚å¯Ÿè€…â€ï¼Œâ€œä»£ç†â€æˆ–å…¶ä»–ä»»ä½•ä¸œè¥¿ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¤è€çš„æ•°å­—:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
<span class="token operator">&lt;</span>p<span class="token operator">></span>You clicked <span class="token punctuation">{</span>count<span class="token punctuation">}</span> times<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
<span class="token comment">// ...</span></code></pre></div>
<p>æˆ‘ä»¬çš„ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶ï¼Œæˆ‘ä»¬ä»<code class="language-text">useState()</code>å¾—åˆ°çš„<code class="language-text">count</code>å˜é‡æ˜¯<code class="language-text">0</code>ã€‚å½“æˆ‘ä»¬è°ƒç”¨<code class="language-text">setCount(1)</code>æ—¶ï¼ŒReactå†æ¬¡è°ƒç”¨æˆ‘ä»¬çš„ç»„ä»¶ã€‚è¿™ä¸€æ¬¡ï¼Œ<code class="language-text">count</code>å°†æ˜¯<code class="language-text">1</code>ã€‚ä¾æ­¤ç±»æ¨ï¼š</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// During first render</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// Returned by useState()</span>
  <span class="token comment">// ...</span>
  <span class="token operator">&lt;</span>p<span class="token operator">></span>You clicked <span class="token punctuation">{</span>count<span class="token punctuation">}</span> times<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// After a click, our function is called again</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// Returned by useState()</span>
  <span class="token comment">// ...</span>
  <span class="token operator">&lt;</span>p<span class="token operator">></span>You clicked <span class="token punctuation">{</span>count<span class="token punctuation">}</span> times<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// After another click, our function is called again</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// Returned by useState()</span>
  <span class="token comment">// ...</span>
  <span class="token operator">&lt;</span>p<span class="token operator">></span>You clicked <span class="token punctuation">{</span>count<span class="token punctuation">}</span> times<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>æ¯å½“æˆ‘ä»¬æ›´æ–°çŠ¶æ€æ—¶ï¼ŒReactéƒ½ä¼šè°ƒç”¨æˆ‘ä»¬çš„ç»„ä»¶ã€‚æ¯ä¸ªæ¸²æŸ“ç»“æœâ€œçœ‹åˆ°â€å®ƒè‡ªå·±çš„<code class="language-text">counter</code>çŠ¶æ€å€¼ï¼Œè¿™æ˜¯æˆ‘ä»¬å‡½æ•°å†…çš„å¸¸é‡ã€‚</strong></p>
<p>æ‰€ä»¥è¿™ä¸€è¡Œæ²¡æœ‰åšä»»ä½•ç‰¹æ®Šçš„æ•°æ®ç»‘å®šï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre></div>
<p><strong>å®ƒåªæ˜¯åœ¨æ¸²æŸ“è¾“å‡ºä¸­åµŒå…¥ä¸€ä¸ªæ•°å€¼ã€‚</strong> è¯¥æ•°å­—ç”±Reactæä¾›ã€‚å½“æˆ‘ä»¬<code class="language-text">setCount</code>æ—¶ï¼ŒReactå†æ¬¡ä½¿ç”¨ä¸åŒçš„<code class="language-text">count</code>å€¼è°ƒç”¨æˆ‘ä»¬çš„ç»„ä»¶ã€‚ç„¶åReactæ›´æ–°DOMä»¥åŒ¹é…æˆ‘ä»¬æœ€æ–°çš„æ¸²æŸ“è¾“å‡ºã€‚</p>
<p>å…³é”®æ˜¯ï¼Œä»»ä½•ç‰¹å®šæ¸²æŸ“ä¸­çš„<code class="language-text">count</code>å¸¸é‡éƒ½ä¸ä¼šéšæ—¶é—´å˜åŒ–ã€‚å†æ¬¡è°ƒç”¨çš„æ˜¯æˆ‘ä»¬çš„ç»„ä»¶â€”â€”æ¯ä¸ªæ¸²æŸ“éƒ½â€œçœ‹åˆ°â€è‡ªå·±çš„<code class="language-text">count</code>å€¼ï¼Œè¯¥å€¼åœ¨æ¸²æŸ“ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ã€‚</p>
<p>(æœ‰å…³æ­¤è¿‡ç¨‹çš„æ·±å…¥æ¦‚è¿°ï¼Œè¯·æŸ¥çœ‹æˆ‘çš„å¸–å­<a href="https://github.com/xiaohesong/TIL/blob/master/front-end/react/overreact/react%E4%BD%9C%E4%B8%BAui%E8%BF%90%E8%A1%8C.md" target="_blank" rel="nofollow noopener noreferrer">Reactä½œä¸ºUIè¿è¡Œæ—¶</a>ã€‚)</p>
<h2 id="æ¯ä¸ªæ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„äº‹ä»¶å¤„ç†ç¨‹åº"><a href="#%E6%AF%8F%E4%B8%AA%E6%B8%B2%E6%9F%93%E9%83%BD%E6%9C%89%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F" aria-label="æ¯ä¸ªæ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„äº‹ä»¶å¤„ç†ç¨‹åº permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æ¯ä¸ªæ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„äº‹ä»¶å¤„ç†ç¨‹åº</h2>
<p>åˆ°ç°åœ¨ä¸ºæ­¢è¿˜æŒºå¥½ã€‚é‚£ä¹ˆå…³äºäº‹ä»¶å¤„ç†ç¨‹åºæ˜¯æ€æ ·çš„ï¼Ÿ</p>
<p>çœ‹çœ‹è¿™ä¸ªä¾‹å­ã€‚å®ƒä¼šåœ¨ä¸‰ç§’é’Ÿåæ˜¾ç¤º<code class="language-text">count</code>çš„å¼¹æ¡†ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'You clicked on: '</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        Click me
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleAlertClick<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        Show alert
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å‡è®¾æˆ‘æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li><strong>å¢åŠ </strong> è®¡æ•°åˆ°3</li>
<li><strong>ç‚¹å‡»</strong> â€œShow alertâ€</li>
<li><strong>å¢åŠ </strong> åˆ°5ï¼Œåœ¨timeoutè§¦å‘ä¹‹å‰</li>
</ul>
<p><img src="https://overreacted.io/counter-46c55d5f1f749462b7a173f1e748e41e.gif"></p>
<p>ä½ å¸Œæœ›å¼¹å‡ºæ¡†æ˜¾ç¤ºä»€ä¹ˆï¼Ÿå®ƒä¼šæ˜¾ç¤º5 - è¿™æ˜¯å¼¹æ¡†æ—¶çš„è®¡æ•°å™¨çŠ¶æ€å—ï¼Ÿæˆ–è€…å®ƒä¼šæ˜¾ç¤º3 - æˆ‘ç‚¹å‡»æ—¶çš„çŠ¶æ€ï¼Ÿ</p>
<hr>
<p>å‰§é€</p>
<hr>
<p>æ¥å§ï¼Œ<a href="%5Btry%20it%20yourself!%5D(https://codesandbox.io/s/w2wxl3yo0l)">äº²è‡ªå°è¯•ä¸€ä¸‹</a>ï¼</p>
<p>å¦‚æœè¿™ç§è¡Œä¸ºå¯¹ä½ æ²¡æœ‰æ„ä¹‰ï¼Œæƒ³è±¡ä¸€ä¸ªæ›´å®é™…çš„ä¾‹å­ï¼šä¸€ä¸ªèŠå¤©åº”ç”¨ç¨‹åºï¼Œå½“å‰æ”¶ä»¶äººIDåœ¨çŠ¶æ€ä¸­ï¼Œå¹¶æœ‰ä¸€ä¸ªå‘é€æŒ‰é’®ã€‚<a href="https://github.com/xiaohesong/TIL/blob/master/front-end/react/overreact/%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6%E4%B8%8E%E7%B1%BB%E6%9C%89%E4%BB%80%E4%B9%88%E4%B8%8D%E5%90%8C.md" target="_blank" rel="nofollow noopener noreferrer">è¿™ç¯‡æ–‡ç« </a>æ·±å…¥æ¢è®¨äº†åŸå› ï¼Œä½†æ­£ç¡®çš„ç­”æ¡ˆæ˜¯3ã€‚</p>
<p>å¼¹æ¡†(alert)å°†åœ¨æˆ‘å•å‡»æŒ‰é’®æ—¶â€œæ•è·â€çŠ¶æ€ã€‚</p>
<p>(<em>æœ‰ä¸€äº›æ–¹æ³•å¯ä»¥å®ç°å…¶ä»–è¡Œä¸ºï¼Œä½†æˆ‘ç°åœ¨å°†å…³æ³¨é»˜è®¤æƒ…å†µã€‚å½“æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªå¿ƒç†æ¨¡å‹æ—¶ï¼Œé‡è¦çš„æ˜¯æˆ‘ä»¬è¦åŒºåˆ†â€œæœ€å°é˜»åŠ›è·¯å¾„â€å’Œé€‰æ‹©è¿›å…¥é€ƒç”Ÿèˆ±ã€‚</em>)</p>
<hr>
<p>ä½†å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</p>
<p>æˆ‘ä»¬å·²ç»è®¨è®ºè¿‡<code class="language-text">count</code>å€¼å¯¹äºæˆ‘ä»¬å‡½æ•°çš„æ¯ä¸ªç‰¹å®šè°ƒç”¨éƒ½æ˜¯å¸¸é‡ã€‚å€¼å¾—å¼ºè°ƒçš„æ˜¯è¿™ä¸€ç‚¹ â€” <strong>æˆ‘ä»¬çš„å‡½æ•°è¢«è°ƒç”¨äº†å¾ˆå¤šæ¬¡(æ¯æ¬¡æ¸²æŸ“ä¸€æ¬¡)ï¼Œä½†æ˜¯æ¯æ¬¡è°ƒç”¨çš„<code class="language-text">count</code>å€¼éƒ½æ˜¯å¸¸é‡ï¼Œå¹¶è¢«è®¾ç½®ä¸ºä¸€ä¸ªç‰¹å®šçš„å€¼(è¯¥æ¸²æŸ“çš„çŠ¶æ€)ã€‚</strong> </p>
<p>è¿™ä¸æ˜¯Reactæ‰€ç‰¹æœ‰çš„ - å¸¸è§„å‡½æ•°ä»¥ç±»ä¼¼çš„æ–¹å¼å·¥ä½œï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> name <span class="token operator">=</span> person<span class="token punctuation">.</span>name<span class="token punctuation">;</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Hello, '</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> someone <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'Dan'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span>someone<span class="token punctuation">)</span><span class="token punctuation">;</span>

someone <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'Yuzhi'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span>someone<span class="token punctuation">)</span><span class="token punctuation">;</span>

someone <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'Dominic'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span>someone<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>åœ¨<a href="https://codesandbox.io/s/mm6ww11lk8" target="_blank" rel="nofollow noopener noreferrer">æ­¤ç¤ºä¾‹</a>ä¸­ï¼Œå¤–éƒ¨<code class="language-text">someone</code>å˜é‡è¢«é‡æ–°åˆ†é…å¤šæ¬¡ã€‚(å°±åƒReactä¸­çš„æŸä¸ªåœ°æ–¹ä¸€æ ·ï¼Œ<em>å½“å‰</em> çš„ç»„ä»¶çŠ¶æ€å¯ä»¥æ”¹å˜ã€‚) <strong>ä½†æ˜¯ï¼Œåœ¨<code class="language-text">sayHi</code>ä¸­ï¼Œæœ‰ä¸€ä¸ªæœ¬åœ°<code class="language-text">name</code>å¸¸é‡ä¸ç‰¹å®šè°ƒç”¨ä¸­çš„<code class="language-text">person</code>ç›¸å…³è”ã€‚</strong> é‚£ä¸ªå¸¸é‡æ˜¯æœ¬åœ°çš„ï¼Œæ‰€ä»¥å®ƒåœ¨è°ƒç”¨ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼å› æ­¤ï¼Œå½“è¶…æ—¶è§¦å‘æ—¶ï¼Œæ¯ä¸ªå¼¹æ¡†éƒ½ä¼šâ€œè®°ä½â€ä»–è‡ªå·±çš„<code class="language-text">name</code>ã€‚</p>
<p>è¿™è§£é‡Šäº†æˆ‘ä»¬çš„äº‹ä»¶å¤„ç†ç¨‹åºå¦‚ä½•åœ¨å•å‡»æ—¶æ•è·<code class="language-text">count</code>ã€‚å¦‚æœæˆ‘ä»¬åº”ç”¨ç›¸åŒçš„æ›¿æ¢åŸåˆ™ï¼Œæ¯ä¸ªæ¸²æŸ“â€œçœ‹åˆ°â€å®ƒè‡ªå·±çš„<code class="language-text">count</code>ï¼š</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// During first render</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// Returned by useState()  // ...</span></span>  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'You clicked on: '</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// After a click, our function is called again</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// Returned by useState()  // ...</span></span>  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'You clicked on: '</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// After another click, our function is called again</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// Returned by useState()  // ...</span></span>  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'You clicked on: '</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å¦‚æ­¤æœ‰æ•ˆï¼Œæ¯ä¸ªæ¸²æŸ“éƒ½è¿”å›è‡ªå·±â€œç‰ˆæœ¬â€çš„<code class="language-text">handleAlertClick</code>ã€‚æ¯ä¸ªç‰ˆæœ¬éƒ½â€œè®°ä½â€è‡ªå·±çš„<code class="language-text">count</code>ï¼š</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// During first render</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'You clicked on: '</span> <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleAlertClick<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span> <span class="token comment">// The one with 0 inside</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// After a click, our function is called again</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'You clicked on: '</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleAlertClick<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span> <span class="token comment">// The one with 1 inside</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// After another click, our function is called again</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'You clicked on: '</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleAlertClick<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span> <span class="token comment">// The one with 2 inside</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ<a href="https://codesandbox.io/s/w2wxl3yo0l" target="_blank" rel="nofollow noopener noreferrer">åœ¨è¿™ä¸ªæ¼”ç¤º</a>ä¸­ äº‹ä»¶å¤„ç†ç¨‹åºâ€œå±äºâ€ç‰¹å®šæ¸²æŸ“ï¼Œå½“ä½ ç‚¹å‡»æ—¶ï¼Œå®ƒä¼šç»§ç»­ä½¿ç”¨ <em>è¯¥</em> æ¸²æŸ“ä¸­çš„<code class="language-text">counter</code>çŠ¶æ€ã€‚</p>
<p><strong>åœ¨ä»»ä½•ç‰¹å®šæ¸²æŸ“ä¸­ï¼Œpropså’ŒçŠ¶æ€æ°¸è¿œä¿æŒä¸å˜ã€‚</strong> ä½†æ˜¯ï¼Œå¦‚æœåœ¨æ¸²æŸ“ä¹‹é—´éš”ç¦»äº†propså’ŒçŠ¶æ€ï¼Œé‚£ä¹ˆä½¿ç”¨å®ƒä»¬çš„ä»»ä½•å€¼(åŒ…æ‹¬äº‹ä»¶å¤„ç†ç¨‹åº)éƒ½æ˜¯ç‹¬ç«‹çš„ã€‚å®ƒä»¬ä¹Ÿâ€œå±äºâ€ç‰¹å®šçš„æ¸²æŸ“ã€‚å› æ­¤ï¼Œå³ä½¿äº‹ä»¶å¤„ç†ç¨‹åºä¸­çš„å¼‚æ­¥å‡½æ•°ä¹Ÿä¼šâ€œçœ‹åˆ°â€ç›¸åŒçš„<code class="language-text">count</code>å€¼ã€‚</p>
<p><em>æ—æ³¨ï¼šæˆ‘å°†å…·ä½“<code class="language-text">count</code>å€¼å†…è”åˆ°ä¸Šé¢çš„<code class="language-text">handleAlertClick</code>å‡½æ•°ä¸­ã€‚è¿™ç§å¿ƒç†æ›¿ä»£æ˜¯å®‰å…¨çš„ï¼Œå› ä¸º<code class="language-text">count</code>ä¸å¯èƒ½åœ¨ç‰¹å®šæ¸²æŸ“ä¸­æ”¹å˜ã€‚å®ƒè¢«å£°æ˜ä¸º<code class="language-text">const</code>å¹¶ä¸”æ˜¯ä¸€ä¸ªæ•°å­—ã€‚ä»¥åŒæ ·çš„æ–¹å¼è€ƒè™‘å…¶ä»–å€¼(æ¯”å¦‚å¯¹è±¡)æ˜¯å®‰å…¨çš„ï¼Œä½†å‰ææ˜¯æˆ‘ä»¬åŒæ„é¿å…çŠ¶æ€çš„å˜åŒ–ã€‚ä½¿ç”¨æ–°åˆ›å»ºçš„å¯¹è±¡è°ƒç”¨<code class="language-text">setSomething(newObj)</code>è€Œä¸æ˜¯å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œå› ä¸ºå±äºä»¥å‰æ¸²æŸ“çš„çŠ¶æ€æ˜¯å®Œæ•´çš„ã€‚</em></p>
<h2 id="æ¯ä¸ªæ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„æ•ˆæœeffects"><a href="#%E6%AF%8F%E4%B8%AA%E6%B8%B2%E6%9F%93%E9%83%BD%E6%9C%89%E8%87%AA%E5%B7%B1%E7%9A%84%E6%95%88%E6%9E%9Ceffects" aria-label="æ¯ä¸ªæ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„æ•ˆæœeffects permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æ¯ä¸ªæ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„æ•ˆæœ(effects)</h2>
<p>è¿™åº”è¯¥æ˜¯ä¸€ä¸ªå…³äºæ•ˆæœçš„è®ºè¿°ï¼Œä½†æˆ‘ä»¬è¿˜æ²¡æœ‰è°ˆåˆ°æ•ˆæœ!æˆ‘ä»¬ç°åœ¨è¦çº æ­£è¿™ä¸ªé—®é¢˜ã€‚äº‹å®è¯æ˜ï¼Œæ•ˆæœå¹¶æ²¡æœ‰ä»€ä¹ˆä¸åŒã€‚</p>
<p>è®©æˆ‘ä»¬å›åˆ°<a href="https://github.com/xiaohesong/TIL/blob/master/front-end/react/hooks/effect-hook.md" target="_blank" rel="nofollow noopener noreferrer">æ–‡æ¡£ä¸­</a>çš„ä¸€ä¸ªä¾‹å­ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        Click me
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼šæ•ˆæœå¦‚ä½•è¯»å–æœ€æ–°çš„<code class="language-text">count</code>çŠ¶æ€ï¼Ÿ</strong> </p>
<p>ä¹Ÿè®¸ï¼Œæœ‰æŸç§â€œæ•°æ®ç»‘å®šâ€æˆ–â€œè§‚æŸ¥â€ä½¿å¾—<code class="language-text">count</code>æ›´æ–°åœ¨æ•ˆæœå‡½æ•°ä¸­ç”Ÿæ•ˆï¼Ÿä¹Ÿè®¸<code class="language-text">count</code>æ˜¯ä¸€ä¸ªå¯å˜å˜é‡ï¼ŒReactåœ¨æˆ‘ä»¬çš„ç»„ä»¶ä¸­è®¾ç½®ï¼Œä»¥ä¾¿æˆ‘ä»¬çš„æ•ˆæœæ€»èƒ½çœ‹åˆ°æœ€æ–°å€¼ï¼Ÿ</p>
<p>ä¸ã€‚</p>
<p>æˆ‘ä»¬å·²ç»çŸ¥é“<code class="language-text">count</code>åœ¨ç‰¹å®šç»„ä»¶æ¸²æŸ“ä¸­æ˜¯æ’å®š(å¸¸é‡)çš„ã€‚äº‹ä»¶å¤„ç†ç¨‹åºä»æ¸²æŸ“ä¸­â€œæŸ¥çœ‹â€å®ƒä»¬â€œæ‰€å±â€çš„<code class="language-text">count</code>çŠ¶æ€ï¼Œå› ä¸º<code class="language-text">count</code>æ˜¯å®ƒä»¬ä½œç”¨åŸŸä¸­çš„ä¸€ä¸ªå˜é‡ã€‚æ•ˆæœä¹Ÿæ˜¯å¦‚æ­¤ï¼</p>
<p><strong><code class="language-text">count</code>å˜é‡ä¸æ˜¯ä»¥æŸç§æ–¹å¼åœ¨â€œä¸å˜â€æ•ˆæœä¸­å‘ç”Ÿå˜åŒ–ã€‚<em>æ•ˆæœå‡½æ•°æœ¬èº«</em> åœ¨æ¯ä¸ªæ¸²æŸ“ä¸Šéƒ½æ˜¯ä¸åŒçš„ã€‚</strong></p>
<p>æ¯ä¸ªç‰ˆæœ¬ä»å…¶â€œæ‰€å±â€çš„æ¸²æŸ“ä¸­â€œçœ‹åˆ°â€<code class="language-text">count</code>å€¼ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// During first render</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// ä¸»è¦æ˜¯çœ‹è¿™é‡Œ</span>
    <span class="token comment">// Effect function from first render</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">0</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// After a click, our function is called again</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// ä¸»è¦æ˜¯çœ‹è¿™é‡Œ</span>
    <span class="token comment">// Effect function from second render</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// After another click, our function is called again</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// ä¸»è¦æ˜¯çœ‹è¿™é‡Œ</span>
    <span class="token comment">// Effect function from third render</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">2</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ..</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Reactä¼šè®°ä½ä½ æä¾›çš„æ•ˆæœå‡½æ•°ï¼Œåˆ·æ–°å¯¹DOMçš„æ›´æ”¹å¹¶è®©æµè§ˆå™¨ç»˜åˆ¶åˆ°å±å¹•åè¿è¡Œè¯¥å‡½æ•°ã€‚</p>
<p>å› æ­¤ï¼Œå³ä½¿æˆ‘ä»¬åœ¨è¿™é‡Œè°ˆåˆ°å•ä¸€æ¦‚å¿µçš„<em>æ•ˆæœ</em>(ç¤ºä¾‹ä¸­çš„æ›´æ–°æ–‡æ¡£æ ‡é¢˜(<code class="language-text">document.title=&#39;&#39;</code>))ï¼Œå®ƒä¹Ÿä¼šåœ¨æ¯ä¸ªæ¸²æŸ“ä¸Šç”¨<em>ä¸åŒçš„å‡½æ•°</em> è¡¨ç¤º â€” å¹¶ä¸”æ¯ä¸ªæ•ˆæœå‡½æ•°ä»å®ƒæ‰€å±çš„ç‰¹å®šæ¸²æŸ“ä¸­â€œçœ‹åˆ°â€propså’ŒçŠ¶æ€ã€‚</p>
<p><strong>ä»æ¦‚å¿µä¸Šè®²ï¼Œä½ å¯ä»¥æƒ³è±¡æ•ˆæœæ˜¯ <em>æ¸²æŸ“ç»“æœçš„ä¸€éƒ¨åˆ†</em> ã€‚</strong> </p>
<p>ä¸¥æ ¼åœ°è¯´ï¼Œå®ƒä»¬ä¸æ˜¯(ä¸ºäº†<a href="https://github.com/xiaohesong/TIL/blob/master/front-end/react/overreact/Why-Do-React-Hooks-Rely-on-Call-Order.md" target="_blank" rel="nofollow noopener noreferrer">å…è®¸Hookç»„åˆ</a>è€Œæ²¡æœ‰ç¬¨æ‹™çš„è¯­æ³•æˆ–è¿è¡Œæ—¶å¼€é”€)ã€‚ä½†æ˜¯åœ¨æˆ‘ä»¬æ„å»ºçš„å¿ƒç†æ¨¡å‹ä¸­ï¼Œæ•ˆæœå‡½æ•°å±äºç‰¹å®šçš„æ¸²æŸ“ï¼Œå°±åƒäº‹ä»¶å¤„ç†ç¨‹åºä¸€æ ·ã€‚</p>
<hr>
<p>ä¸ºäº†ç¡®ä¿æˆ‘ä»¬æœ‰ä¸€ä¸ªæ‰å®çš„ç†è§£ï¼Œè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æˆ‘ä»¬çš„ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼š</p>
<ul>
<li><strong>React:</strong> ç»™æˆ‘ä¸€ä¸ªå½“çŠ¶æ€ä¸º<code class="language-text">0</code>æ—¶UIã€‚</li>
<li>
<p><strong>ä½ çš„ç»„ä»¶:</strong> </p>
<ul>
<li>è¿™æ˜¯æ¸²æŸ“ç»“æœï¼š<code class="language-text">&lt;p&gt;You clicked 0 times&lt;/p&gt;</code>ã€‚</li>
<li>è¿˜è®°å¾—åœ¨å®Œæˆåè¿è¡Œæ­¤æ•ˆæœï¼š<code class="language-text">() =&gt; { document.title = &#39;You clicked 0 times&#39; }</code>ã€‚</li>
</ul>
</li>
<li><strong>React:</strong> å½“ç„¶ã€‚æ›´æ–°UIã€‚å˜¿æµè§ˆå™¨ï¼Œæˆ‘æ­£åœ¨å‘DOMæ·»åŠ ä¸€äº›ä¸œè¥¿ã€‚</li>
<li><strong>Browser:</strong> å¾ˆé…·ï¼Œæˆ‘æŠŠå®ƒç”»åˆ°äº†å±å¹•ä¸Šã€‚</li>
<li>
<p><strong>React:</strong> å¥½çš„ï¼Œç°åœ¨æˆ‘è¦è¿è¡Œä½ ç»™æˆ‘çš„æ•ˆæœäº†ã€‚</p>
<ul>
<li>è¿è¡Œ <code class="language-text">() =&gt; { document.title = &#39;You clicked 0 times&#39; }</code>ã€‚</li>
</ul>
</li>
</ul>
<hr>
<p>ç°åœ¨è®©æˆ‘ä»¬å›é¡¾ç‚¹å‡»åå‘ç”Ÿçš„äº‹æƒ…ï¼š</p>
<ul>
<li><strong>ä½ çš„ç»„ä»¶:</strong> å˜¿Reactï¼ŒæŠŠæˆ‘çš„çŠ¶æ€è®¾ç½®ä¸º<code class="language-text">1</code>ã€‚</li>
<li><strong>React:</strong> ç»™æˆ‘çŠ¶æ€ä¸º<code class="language-text">1</code>æ—¶çš„UIã€‚</li>
<li>
<p><strong>ä½ çš„ç»„ä»¶:</strong> </p>
<ul>
<li>è¿™æ˜¯æ¸²æŸ“ç»“æœï¼š<code class="language-text">&lt;p&gt;You clicked 1 times&lt;/p&gt;</code>ã€‚</li>
<li>è¿˜è®°å¾—åœ¨å®Œæˆåè¿è¡Œæ­¤æ•ˆæœï¼š<code class="language-text">() =&gt; { document.title = &#39;You clicked 1 times&#39; }</code>ã€‚</li>
</ul>
</li>
<li><strong>React:</strong> å½“ç„¶ã€‚æ›´æ–°UIã€‚å˜¿æµè§ˆå™¨ï¼Œæˆ‘æ”¹å˜äº†DOMã€‚</li>
<li><strong>Browser:</strong> å¾ˆé…·ï¼Œæˆ‘æŠŠä½ çš„æ›´æ”¹ç”»åˆ°äº†å±å¹•ä¸Šã€‚</li>
<li>
<p><strong>React:</strong> å¥½çš„ï¼Œç°åœ¨æˆ‘å°†è¿è¡Œå±äºæˆ‘åˆšåˆšåšçš„æ¸²æŸ“çš„æ•ˆæœã€‚</p>
<ul>
<li>è¿è¡Œ <code class="language-text">() =&gt; { document.title = &#39;You clicked 1 times&#39; }</code>ã€‚</li>
</ul>
</li>
</ul>
<h2 id="æ¯ä¸ªæ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±ä¸€åˆ‡"><a href="#%E6%AF%8F%E4%B8%AA%E6%B8%B2%E6%9F%93%E9%83%BD%E6%9C%89%E5%AE%83%E8%87%AA%E5%B7%B1%E4%B8%80%E5%88%87" aria-label="æ¯ä¸ªæ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±ä¸€åˆ‡ permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æ¯ä¸ªæ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±â€¦ä¸€åˆ‡</h2>
<p><strong>æˆ‘ä»¬ç°åœ¨çŸ¥é“åœ¨æ¯æ¬¡æ¸²æŸ“ä¹‹åè¿è¡Œçš„æ•ˆæœåœ¨æ¦‚å¿µä¸Šæ˜¯ç»„ä»¶è¾“å‡ºçš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”â€œçœ‹åˆ°â€æ¥è‡ªè¯¥ç‰¹å®šæ¸²æŸ“çš„propså’ŒçŠ¶æ€ã€‚</strong> </p>
<p>æˆ‘ä»¬æ¥è¯•è¯•å§ã€‚è€ƒè™‘ä»¥ä¸‹ä»£ç ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// æ‰‹åŠ¨é«˜äº®</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        Click me
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å¦‚æœæˆ‘ç¨å¾®ç‚¹å‡»å‡ æ¬¡ï¼Œé‚£ä¹ˆlogä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿ</p>
<hr>
<p>å‰§é€</p>
<hr>
<p>ä½ å¯èƒ½è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œæœ€ç»ˆç»“æœæ˜¯ä¸ç›´è§‚çš„ã€‚ä¸æ˜¯è¿™æ ·çš„ï¼æˆ‘ä»¬å°†çœ‹åˆ°ä¸€ç³»åˆ—æ—¥å¿— - æ¯ä¸ªæ—¥å¿—å±äºç‰¹å®šçš„æ¸²æŸ“ï¼Œå› æ­¤å…·æœ‰è‡ªå·±çš„<code class="language-text">count</code>å€¼ã€‚ä½ å¯ä»¥<a href="https://codesandbox.io/s/lyx20m1ol" target="_blank" rel="nofollow noopener noreferrer">è‡ªå·±è¯•è¯•</a>ï¼š</p>
<p><img src="https://overreacted.io/timeout_counter-a5727d333c270e05942f508707265378.gif"></p>
<p>ä½ å¯èƒ½ä¼šæƒ³ï¼šâ€œå½“ç„¶ï¼Œè¿™å°±æ˜¯å®ƒçš„å·¥ä½œåŸç†ï¼ä¸ç„¶å®ƒè¿˜èƒ½æ€æ ·å·¥ä½œï¼Ÿâ€œ</p>
<p>å¥½å§ï¼Œè¿™ä¸æ˜¯<code class="language-text">this.state</code>åœ¨ç±»ä¸Šçš„è¿ä½œæ–¹å¼ã€‚å¾ˆå®¹æ˜“é”™è¯¯åœ°è®¤ä¸ºè¿™ä¸ª<a href="https://codesandbox.io/s/kkymzwjqz3" target="_blank" rel="nofollow noopener noreferrer">ç±»çš„å®ç°</a>æ˜¯ç­‰ä»·çš„:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ä½†æ˜¯ï¼Œ<code class="language-text">this.state.count</code>å§‹ç»ˆæŒ‡å‘æœ€æ–°è®¡æ•°è€Œä¸æ˜¯å±äºç‰¹å®šæ¸²æŸ“çš„è®¡æ•°ã€‚æ‰€ä»¥ä½ ä¼šçœ‹åˆ°æ¯æ¬¡è®°å½•<code class="language-text">5</code>ï¼š</p>
<p><img src="https://overreacted.io/timeout_counter_class-264b329edc111a1973003bdf2bcacd65.gif"></p>
<p>æˆ‘è®¤ä¸ºå…·æœ‰è®½åˆºæ„å‘³çš„æ˜¯ï¼ŒHookä¸¥é‡ä¾èµ–äºJavaScripté—­åŒ…ï¼Œç„¶è€Œæ­£æ˜¯ç±»å®ç°é­å—äº†<a href="https://wsvincent.com/javascript-closure-settimeout-for-loop/" target="_blank" rel="nofollow noopener noreferrer">å…¸å‹çš„è¶…æ—¶é”™è¯¯å€¼çš„æ··æ·†</a>ï¼Œè€Œè¿™ç§æ··æ·†é€šå¸¸ä¸é—­åŒ…ç›¸å…³ã€‚è¿™æ˜¯å› ä¸ºæœ¬ä¾‹ä¸­æ··æ·†çš„å®é™…æ¥æºæ˜¯çªå˜ï¼ˆreactä½¿ç±»ä¸­çš„<code class="language-text">this.state</code>å‘ç”Ÿçªå˜ï¼Œä»¥æŒ‡å‘æœ€æ–°çŠ¶æ€ï¼‰ï¼Œè€Œä¸æ˜¯é—­åŒ…æœ¬èº«ã€‚</p>
<p><strong>å½“ä½ ç›¸å…³çš„å€¼æ°¸è¿œä¸å˜æ—¶ï¼Œé—­åŒ…æ˜¯éå¸¸æ£’çš„ã€‚è¿™ä½¿å¾—å®ƒä»¬æ˜“äºæ€è€ƒï¼Œå› ä¸ºä½ å®è´¨ä¸Šæ˜¯æŒ‡å‘å¸¸é‡ã€‚</strong> æ­£å¦‚æˆ‘ä»¬æ‰€è®¨è®ºçš„ï¼Œpropså’ŒçŠ¶æ€æ°¸è¿œä¸ä¼šåœ¨ç‰¹å®šæ¸²æŸ“ä¸­å‘ç”Ÿå˜åŒ–ã€‚é¡ºä¾¿è¯´ä¸€å¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<a href="https://codesandbox.io/s/w7vjo07055" target="_blank" rel="nofollow noopener noreferrer">ä½¿ç”¨é—­åŒ…</a>ä¿®å¤ç±»ç‰ˆæœ¬ä¸­çš„é—®é¢˜ã€‚</p>
<h2 id="é€†åŠ¿è€Œè¡Œé€†æµè€Œä¸Šswimming-against-the-tide"><a href="#%E9%80%86%E5%8A%BF%E8%80%8C%E8%A1%8C%E9%80%86%E6%B5%81%E8%80%8C%E4%B8%8Aswimming-against-the-tide" aria-label="é€†åŠ¿è€Œè¡Œé€†æµè€Œä¸Šswimming against the tide permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>é€†åŠ¿è€Œè¡Œ(é€†æµè€Œä¸Š)(Swimming Against the Tide)</h2>
<p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬æ˜ç¡®åœ°ç§°ä¹‹ä¸ºï¼šç»„ä»¶æ¸²æŸ“ä¸­çš„ <strong>æ¯ä¸ª</strong> å‡½æ•°(åŒ…æ‹¬äº‹ä»¶å¤„ç†ç¨‹åºã€æ•ˆæœã€è¶…æ—¶æˆ–å…¶ä¸­çš„APIè°ƒç”¨)éƒ½ä¼šæ•è·å®šä¹‰å®ƒçš„æ¸²æŸ“è°ƒç”¨çš„propså’ŒçŠ¶æ€ã€‚</p>
<p>æ‰€ä»¥è¿™ä¸¤ä¸ªä¾‹å­æ˜¯ç­‰ä»·çš„ï¼š</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> counter <span class="token operator">=</span> props<span class="token punctuation">.</span>counter<span class="token punctuation">;</span></span>  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>æ— è®ºä½ æ˜¯å¦åœ¨ç»„ä»¶å†…éƒ¨ä»propsæˆ–çŠ¶æ€ä¸­â€æå‰â€è¯»å–éƒ½æ— å…³ç´§è¦ã€‚</strong> ä»–ä»¬ä¸ä¼šæ”¹å˜ï¼åœ¨å•ä¸ªæ¸²æŸ“çš„ä½œç”¨åŸŸå†…ï¼Œpropså’ŒçŠ¶æ€ä¿æŒä¸å˜ã€‚ ï¼ˆè§£æ„propsä½¿è¿™æ›´åŠ æ˜æ˜¾ã€‚ï¼‰</p>
<p>å½“ç„¶ï¼Œæœ‰æ—¶ä½ å¸Œæœ›åœ¨æ•ˆæœä¸­å®šä¹‰çš„æŸäº›å›è°ƒä¸­è¯»å–æœ€æ–°è€Œéæ•è·çš„å€¼ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨refsï¼Œå¦‚<a href="#1">æœ¬æ–‡</a>æœ€åä¸€èŠ‚æ‰€è¿°ã€‚</p>
<p>æ³¨æ„ï¼Œå½“ä½ æƒ³ä» <em>è¿‡å»</em> æ¸²æŸ“çš„å‡½æ•°ä¸­è¯»å– <em>æœªæ¥</em> çš„propsæˆ–çŠ¶æ€æ—¶ï¼Œä½ æ˜¯åœ¨é€†æ½®æµè€Œä¸Šã€‚è¿™å¹¶æ²¡æœ‰é”™(åœ¨æŸäº›æƒ…å†µä¸‹æ˜¯å¿…è¦çš„)ï¼Œä½†æ‰“ç ´è¿™ç§æ¨¡å¼å¯èƒ½çœ‹èµ·æ¥ä¸é‚£ä¹ˆâ€œå¹²å‡€â€ã€‚è¿™æ˜¯ä¸€ä¸ªæœ‰æ„çš„ç»“æœï¼Œå› ä¸ºå®ƒæœ‰åŠ©äºçªå‡ºå“ªäº›ä»£ç æ˜¯è„†å¼±çš„ï¼Œå¹¶ä¸”ä¾èµ–äºæ—¶é—´è€Œæ”¹å˜ã€‚åœ¨ç±»ä¸Šï¼Œå‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ä¸å¤ªæ˜æ˜¾ã€‚</p>
<p>è¿™æ˜¯æˆ‘ä»¬çš„<a href="https://codesandbox.io/s/rm7z22qnlp" target="_blank" rel="nofollow noopener noreferrer">è®¡æ•°å™¨ç¤ºä¾‹çš„ä¸€ä¸ªç‰ˆæœ¬</a>ï¼Œå®ƒå¤åˆ¶äº†ç±»çš„è¡Œä¸ºï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> latestCount <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// Set the mutable latest value</span>
    latestCount<span class="token punctuation">.</span>current <span class="token operator">=</span> count<span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">// Read the mutable latest value</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>latestCount<span class="token punctuation">.</span>current<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre></div>
<p><img src="https://overreacted.io/timeout_counter_refs-78f7948263dd13b023498b23cb99f4fc.gif"></p>
<p>åœ¨Reactä¸­æ”¹å˜ä¸€äº›ä¸œè¥¿ä¼¼ä¹å¾ˆå¤æ€ªã€‚ä½†æ˜¯ï¼Œè¿™æ­£æ˜¯Reactæœ¬èº«åœ¨ç±»ä¸­é‡æ–°åˆ†é…<code class="language-text">this.state</code>çš„æ–¹å¼ã€‚ä¸æ•è·çš„propså’Œstateä¸åŒï¼Œä½ æ— æ³•ä¿è¯è¯»å–<code class="language-text">latestCount.current</code>ä¼šåœ¨ä»»ä½•ç‰¹å®šå›è°ƒä¸­ä¸ºä½ æä¾›ç›¸åŒçš„å€¼ã€‚æ ¹æ®å®šä¹‰ï¼Œä½ å¯ä»¥éšæ—¶æ”¹å˜å®ƒã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒä¸æ˜¯é»˜è®¤å€¼ï¼Œä½ å¿…é¡»é€‰æ‹©å®ƒã€‚</p>
<h2 id="é‚£ä¹ˆæ¸…ç†å‘¢"><a href="#%E9%82%A3%E4%B9%88%E6%B8%85%E7%90%86%E5%91%A2" aria-label="é‚£ä¹ˆæ¸…ç†å‘¢ permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>é‚£ä¹ˆæ¸…ç†å‘¢?</h2>
<p>æ­£å¦‚<a href="https://github.com/xiaohesong/TIL/blob/master/front-end/react/hooks/effect-hook.md#%E9%9C%80%E8%A6%81%E6%B8%85%E7%90%86%E7%9A%84%E5%89%AF%E4%BD%9C%E7%94%A8" target="_blank" rel="nofollow noopener noreferrer">æ–‡æ¡£æ‰€è§£é‡Š</a>çš„é‚£æ ·ï¼ŒæŸäº›effectå¯èƒ½ä¼šæœ‰ä¸€ä¸ªæ¸…ç†é˜¶æ®µã€‚æœ¬è´¨ä¸Šï¼Œå®ƒçš„ç›®çš„æ˜¯â€œæ’¤æ¶ˆâ€è®¢é˜…ç­‰æƒ…å†µçš„æ•ˆæœã€‚</p>
<p>è€ƒè™‘ä»¥ä¸‹ä»£ç ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  ChatAPI<span class="token punctuation">.</span><span class="token function">subscribeToFriendStatus</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>id<span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    ChatAPI<span class="token punctuation">.</span><span class="token function">unsubscribeFromFriendStatus</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>id<span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>å‡è®¾<code class="language-text">props</code>åœ¨ç¬¬ä¸€ä¸ªæ¸²æŸ“æ—¶ä¸º<code class="language-text">{idï¼š10}</code>ï¼Œåœ¨ç¬¬äºŒä¸ªæ¸²æŸ“ä¸Šä¸º<code class="language-text">{idï¼š20}</code>ã€‚ä½  <em>å¯èƒ½</em> è®¤ä¸ºä¼šå‘ç”Ÿè¿™æ ·çš„äº‹æƒ…:</p>
<ul>
<li>Reactæ¸…é™¤<code class="language-text">{idï¼š10}</code>çš„æ•ˆæœã€‚</li>
<li>Reactä¸º<code class="language-text">{idï¼š20}</code>æ¸²æŸ“UIã€‚</li>
<li>Reactè¿è¡Œ<code class="language-text">{idï¼š20}</code>çš„æ•ˆæœã€‚</li>
</ul>
<p>(æƒ…å†µå¹¶éå¦‚æ­¤ã€‚)</p>
<p>ä½¿ç”¨è¿™ä¸ªå¿ƒç†æ¨¡å‹ï¼Œä½ å¯èƒ½è®¤ä¸ºæ¸…ç†â€œçœ‹åˆ°â€äº†æ—§çš„propsï¼Œå› ä¸ºå®ƒåœ¨æˆ‘ä»¬é‡æ–°æ¸²æŸ“ä¹‹å‰è¿è¡Œï¼Œç„¶åæ–°çš„æ•ˆæœâ€œçœ‹åˆ°â€äº†æ–°propsï¼Œå› ä¸ºå®ƒåœ¨é‡æ–°æ¸²æŸ“ä¹‹åè¿è¡Œã€‚è¿™æ˜¯ç›´æ¥ä»ç±»ç”Ÿå‘½å‘¨æœŸä¸­æå–çš„å¿ƒæ™ºæ¨¡å‹ï¼Œ<strong>è¿™é‡Œå¹¶ä¸å‡†ç¡®</strong> ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿™æ˜¯ä¸ºä»€ä¹ˆã€‚</p>
<p>Reactä»…åœ¨<a href="https://medium.com/@dan_abramov/this-benchmark-is-indeed-flawed-c3d6b5b6f97f" target="_blank" rel="nofollow noopener noreferrer">è®©æµè§ˆå™¨ç»˜åˆ¶</a>åè¿è¡Œæ•ˆæœã€‚è¿™ä½¿ä½ çš„åº”ç”¨ç¨‹åºæ›´å¿«ï¼Œå› ä¸ºå¤§å¤šæ•°æ•ˆæœä¸éœ€è¦é˜»æ­¢å±å¹•æ›´æ–°ã€‚æ•ˆæœæ¸…ç†ä¹Ÿä¼šå»¶è¿Ÿã€‚<strong>ä½¿ç”¨æ–°propsé‡æ–°æ¸²æŸ“<em>å</em>ï¼Œå‰ä¸€ä¸ªæ•ˆæœä¼šè¢«æ¸…é™¤ï¼š</strong> </p>
<ul>
<li><strong>Reactä¸º<code class="language-text">{idï¼š20}</code>æ¸²æŸ“UIã€‚</strong> </li>
<li>æµè§ˆå™¨ç»˜åˆ¶ç”»é¢ã€‚æˆ‘ä»¬åœ¨å±å¹•ä¸Šçœ‹åˆ°äº†<code class="language-text">{idï¼š20}</code>çš„ç”¨æˆ·ç•Œé¢ã€‚</li>
<li><strong>Reactæ¸…é™¤<code class="language-text">{idï¼š10}</code>çš„æ•ˆæœã€‚</strong> </li>
<li>Reactè¿è¡Œ<code class="language-text">{idï¼š20}</code>çš„æ•ˆæœã€‚</li>
</ul>
<p>ä½ å¯èƒ½æƒ³çŸ¥é“ï¼šä½†æ˜¯å¦‚æœåœ¨propså˜ä¸º<code class="language-text">{idï¼š20}</code>ä¹‹åè¿è¡Œï¼Œé‚£ä¹ˆå‰ä¸€æ•ˆæœçš„æ¸…ç†å¦‚ä½•ä»èƒ½â€œçœ‹åˆ°â€æ—§çš„<code class="language-text">{idï¼š10}</code> propsï¼Ÿ</p>
<p>æˆ‘ä»¬ä»¥å‰æ¥è¿‡è¿™é‡Œâ€¦ğŸ¤”</p>
<p><img src="https://overreacted.io/deja_vu-5fe238cf03a21dfa32af624124fcdcff.gif"></p>
<p>å¼•ç”¨ä¸Šä¸€èŠ‚ï¼š</p>
<blockquote>
<p>ç»„ä»¶æ¸²æŸ“ä¸­çš„ <strong>æ¯ä¸ª</strong> å‡½æ•°(åŒ…æ‹¬äº‹ä»¶å¤„ç†ç¨‹åºã€æ•ˆæœã€è¶…æ—¶æˆ–å…¶ä¸­çš„APIè°ƒç”¨)éƒ½ä¼šæ•è·å®šä¹‰å®ƒçš„æ¸²æŸ“è°ƒç”¨çš„propså’ŒçŠ¶æ€ã€‚</p>
</blockquote>
<p>ç°åœ¨ç­”æ¡ˆå¾ˆæ˜ç¡®ï¼ä¸ç®¡è¿™æ„å‘³ç€ä»€ä¹ˆï¼Œæ•ˆæœæ¸…ç†ä¸ä¼šè¯»å–â€œæœ€æ–°â€çš„propsã€‚å®ƒè¯»å–å±äºå®ƒå®šä¹‰çš„æ¸²æŸ“çš„props:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// First render, props are {id: 10}</span>
<span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// Effect from first render</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      ChatAPI<span class="token punctuation">.</span><span class="token function">subscribeToFriendStatus</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// Cleanup for effect from first render</span>
      <span class="token comment">// å˜¿ï¼Œä½ çš„å…³æ³¨ç‚¹æ”¾åœ¨è¿™é‡Œ(æ‰‹åŠ¨é«˜äº®)</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        ChatAPI<span class="token punctuation">.</span><span class="token function">unsubscribeFromFriendStatus</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// Next render, props are {id: 20}</span>
<span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// Effect from second render</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      ChatAPI<span class="token punctuation">.</span><span class="token function">subscribeToFriendStatus</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// Cleanup for effect from second render</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        ChatAPI<span class="token punctuation">.</span><span class="token function">unsubscribeFromFriendStatus</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç‹å›½å°†ä¼šå‡èµ·å¹¶åŒ–ä¸ºç°çƒ¬ï¼Œå¤ªé˜³å°†ä¼šè¤ªå»å®ƒçš„å¤–å±‚æˆä¸ºä¸€é¢—ç™½çŸ®æ˜Ÿï¼Œæœ€åçš„æ–‡æ˜å°†ä¼šç»ˆç»“ã€‚ä½†æ˜¯é™¤äº†<code class="language-text">{idï¼š10}</code>ä¹‹å¤–ï¼Œæ²¡æœ‰ä»»ä½•ä¸œè¥¿å¯ä»¥ä½¿ç¬¬ä¸€ä¸ªæ¸²æŸ“æ•ˆæœçš„æ¸…ç†â€œçœ‹åˆ°â€propsã€‚</p>
<p>è¿™å°±æ˜¯è®©Reactåœ¨ç»˜åˆ¶åç«‹å³å¤„ç†æ•ˆæœçš„åŸå› â€”â€”é»˜è®¤æƒ…å†µä¸‹è®©ä½ çš„åº”ç”¨ç¨‹åºè¿è¡Œå¾—æ›´å¿«ã€‚å¦‚æœæˆ‘ä»¬çš„ä»£ç éœ€è¦å®ƒä»¬ï¼Œæ—§çš„propsä»ç„¶å­˜åœ¨ã€‚</p>
<h2 id="åŒæ­¥ï¼Œè€Œä¸æ˜¯ç”Ÿå‘½å‘¨æœŸ"><a href="#%E5%90%8C%E6%AD%A5%EF%BC%8C%E8%80%8C%E4%B8%8D%E6%98%AF%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F" aria-label="åŒæ­¥ï¼Œè€Œä¸æ˜¯ç”Ÿå‘½å‘¨æœŸ permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>åŒæ­¥ï¼Œè€Œä¸æ˜¯ç”Ÿå‘½å‘¨æœŸ</h2>
<p>å…³äºReactï¼Œæˆ‘æœ€å–œæ¬¢çš„ä¸€ç‚¹æ˜¯å®ƒç»Ÿä¸€äº†å¯¹åˆå§‹æ¸²æŸ“ç»“æœå’Œæ›´æ–°çš„æè¿°ã€‚è¿™ä¼šä½¿ä½ çš„ç¨‹åº<a href="https://overreacted.io/the-bug-o-notation/" target="_blank" rel="nofollow noopener noreferrer">é™ä½ç†µ</a>ã€‚</p>
<p>å‡è®¾æˆ‘çš„ç»„ä»¶æ˜¯è¿™æ ·çš„ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Greeting<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      Hello, </span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å¦‚æœæˆ‘æ¸²æŸ“<code class="language-text">&lt;Greeting name =&quot;Dan&quot;/&gt;</code>å¹¶ä¸”åé¢åŠ ä¸Š<code class="language-text">&lt;Greeting name =&quot;Yuzhi&quot;/&gt;</code>ï¼Œæˆ–è€…æˆ‘åªæ¸²æŸ“<code class="language-text">&lt;Greeting name =&quot;Yuzhi&quot;/&gt;</code>ï¼Œéƒ½æ— å…³ç´§è¦ã€‚æœ€åï¼Œæˆ‘ä»¬å°†åœ¨ä¸¤ç§æƒ…å†µä¸‹çœ‹åˆ°â€œHello, Yuzhiâ€ã€‚</p>
<p>äººä»¬å¸¸è¯´:â€œé‡è¦çš„æ˜¯è¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ç›®çš„åœ°ã€‚â€è€Œå¯¹äºReactï¼Œæƒ…å†µæ­£å¥½ç›¸åã€‚<strong>é‡è¦çš„æ˜¯ç›®çš„åœ°ï¼Œè€Œä¸æ˜¯æ—…ç¨‹ã€‚</strong> è¿™å°±æ˜¯jQueryä»£ç ä¸­çš„<code class="language-text">$.addClass</code>å’Œ<code class="language-text">$.removeClass</code>è°ƒç”¨ä¹‹é—´(æˆ‘ä»¬çš„â€œæ—…ç¨‹â€)çš„åŒºåˆ«ï¼Œå¹¶æŒ‡å®šäº†åœ¨Reactä»£ç ä¸­CSSç±»<em>åº”è¯¥æ˜¯</em> ä»€ä¹ˆ(æˆ‘ä»¬çš„â€œç›®çš„åœ°â€)ã€‚</p>
<p><strong>Reactæ ¹æ®æˆ‘ä»¬å½“å‰çš„propså’ŒçŠ¶æ€åŒæ­¥DOMã€‚</strong> æ¸²æŸ“æ—¶â€œmountâ€æˆ–â€œupdateâ€ä¹‹é—´æ²¡æœ‰åŒºåˆ«ã€‚</p>
<p>ä½ åº”è¯¥ä»¥ç±»ä¼¼çš„æ–¹å¼æ€è€ƒæ•ˆæœã€‚<strong><code class="language-text">useEffect</code>å…è®¸ä½ æ ¹æ®æˆ‘ä»¬çš„propså’ŒçŠ¶æ€<em>åŒæ­¥</em>Reactæ ‘ä¹‹å¤–çš„ä¸œè¥¿ã€‚</strong> </p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, '</span> <span class="token operator">+</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Greeting<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      Hello, </span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>è¿™ä¸ç†Ÿæ‚‰çš„ <em>mount</em>/<em>update</em>/<em>unmount</em>  å¿ƒç†æ¨¡å‹ç•¥æœ‰ä¸åŒã€‚å°†å…¶å†…åœ¨åŒ–æ˜¯éå¸¸é‡è¦çš„ã€‚<strong>å¦‚æœä½ è¯•å›¾ç¼–å†™ä¸€ä¸ªæ ¹æ®ç»„ä»¶æ˜¯å¦ç¬¬ä¸€æ¬¡æ¸²æŸ“è€Œè¡¨ç°ä¸åŒçš„æ•ˆæœï¼Œé‚£ä¹ˆä½ å°±æ˜¯åœ¨é€†æµè€Œä¸Š!</strong> å¦‚æœæˆ‘ä»¬çš„ç»“æœå–å†³äºâ€œæ—…ç¨‹â€è€Œä¸æ˜¯â€œç›®çš„åœ°â€ï¼Œæˆ‘ä»¬å°±æ— æ³•åŒæ­¥ã€‚</p>
<p>æ— è®ºæˆ‘ä»¬æ˜¯ä½¿ç”¨props Aï¼ŒBå’ŒCæ¸²æŸ“ï¼Œè¿˜æ˜¯ä½¿ç”¨Cç«‹å³æ¸²æŸ“ï¼Œéƒ½æ— å…³ç´§è¦ã€‚è™½ç„¶å¯èƒ½ä¼šæœ‰ä¸€äº›æš‚æ—¶çš„å·®å¼‚(ä¾‹å¦‚ï¼Œåœ¨è·å–æ•°æ®æ—¶)ï¼Œä½†æœ€ç»ˆçš„ç»“æœåº”è¯¥æ˜¯ç›¸åŒçš„ã€‚</p>
<p>å½“ç„¶ï¼Œåœ¨æ¯ä¸ªæ¸²æŸ“ä¸Šè¿è¡Œæ‰€æœ‰æ•ˆæœå¯èƒ½å¹¶ä¸æ˜¯å¾ˆé«˜æ•ˆã€‚(åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™ä¼šå¯¼è‡´æ— é™å¾ªç¯ã€‚)</p>
<p>é‚£æˆ‘ä»¬æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p>
<h2 id="æ•™reactå»diffä½ çš„effects"><a href="#%E6%95%99react%E5%8E%BBdiff%E4%BD%A0%E7%9A%84effects" aria-label="æ•™reactå»diffä½ çš„effects permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æ•™Reactå»Diffä½ çš„Effects</h2>
<p>æˆ‘ä»¬å·²ç»ä»DOMæœ¬èº«å¸å–äº†æ•™è®­ã€‚Reactåªæ›´æ–°DOMä¸­å®é™…å‘ç”Ÿæ›´æ”¹çš„éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯åœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶éƒ½ä¿®æ”¹å®ƒã€‚</p>
<p>å½“ä½ æ›´æ–°</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Greeting<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  Hello, Dan
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></code></pre></div>
<p>åˆ°</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Greeting<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  Hello, Yuzhi
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></code></pre></div>
<p>Reactçœ‹åˆ°ä¸¤ä¸ªå¯¹è±¡ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> oldProps <span class="token operator">=</span> <span class="token punctuation">{</span>className<span class="token punctuation">:</span> <span class="token string">'Greeting'</span><span class="token punctuation">,</span> children<span class="token punctuation">:</span> <span class="token string">'Hello, Dan'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newProps <span class="token operator">=</span> <span class="token punctuation">{</span>className<span class="token punctuation">:</span> <span class="token string">'Greeting'</span><span class="token punctuation">,</span> children<span class="token punctuation">:</span> <span class="token string">'Hello, Yuzhi'</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>å®ƒæ£€æŸ¥å®ƒä»¬çš„æ¯ä¸ªpropsï¼Œå¹¶ç¡®å®šå­å…ƒç´ å·²ç»æ›´æ”¹ï¼Œéœ€è¦DOMæ›´æ–°ï¼Œä½†<code class="language-text">className</code>æ²¡æœ‰ã€‚æ‰€ä»¥å®ƒå¯ä»¥è¿™æ ·åš:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">domNode<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'Hello, Yuzhi'</span><span class="token punctuation">;</span>
<span class="token comment">// No need to touch domNode.className</span></code></pre></div>
<p><strong>æˆ‘ä»¬å¯ä»¥ç”¨æ•ˆæœåšè¿™æ ·çš„äº‹å—ï¼Ÿå¦‚æœä¸éœ€è¦åº”ç”¨æ•ˆæœï¼Œæœ€å¥½é¿å…é‡æ–°è¿è¡Œå®ƒä»¬ã€‚</strong></p>
<p>ä¾‹å¦‚ï¼Œç”±äºçŠ¶æ€æ›´æ”¹ï¼Œæˆ‘ä»¬çš„ç»„ä»¶å¯èƒ½ä¼šé‡æ–°æ¸²æŸ“ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>counter<span class="token punctuation">,</span> setCounter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, '</span> <span class="token operator">+</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Greeting<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      Hello, </span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token punctuation">{</span><span class="token comment">/* ä½ çš„å…³æ³¨ç‚¹åœ¨è¿™é‡Œ */</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token punctuation">{</span><span class="token comment">/* åŸæ–‡æ­¤å¤„æ˜¯count, å®åˆ™ä¸ºcounter */</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCounter</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        Increment
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ä½†æ˜¯æˆ‘ä»¬çš„æ•ˆæœä¸ä½¿ç”¨<code class="language-text">counter</code>çŠ¶æ€ã€‚<strong>æˆ‘ä»¬çš„æ•ˆæœå°†<code class="language-text">document.title</code>ä¸<code class="language-text">name</code> propåŒæ­¥ï¼Œä½†<code class="language-text">name</code> propæ˜¯ç›¸åŒçš„ã€‚</strong> åœ¨æ¯æ¬¡è®¡æ•°å™¨æ›´æ”¹æ—¶é‡æ–°åˆ†é…<code class="language-text">document.title</code>ä¼¼ä¹å¹¶ä¸ç†æƒ³ã€‚</p>
<p>å¥½å§ï¼Œé‚£ä¹ˆReactä¼šä¸ä¼šåªæ˜¯â€¦å·®å¼‚æ•ˆæœ(diff effects)?</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">let</span> <span class="token function-variable function">oldEffect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, Dan'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">newEffect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, Dan'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Can React see these functions do the same thing?</span></code></pre></div>
<p>å¹¶ä¸æ˜¯çš„ã€‚Reactæ— æ³•åœ¨ä¸è°ƒç”¨è¯¥å‡½æ•°çš„æƒ…å†µä¸‹çŒœæµ‹è¯¥å‡½æ•°çš„åŠŸèƒ½ã€‚(æºä»£ç å®é™…ä¸Šå¹¶ä¸åŒ…å«ç‰¹å®šçš„å€¼ï¼Œå®ƒåªæ˜¯åœ¨<code class="language-text">name</code> propä¸Šç»“æŸã€‚)</p>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¦‚æœä½ æƒ³é¿å…ä¸å¿…è¦åœ°é‡æ–°è¿è¡Œæ•ˆæœï¼Œä½ å¯ä»¥ä¸º<code class="language-text">useEffect</code>æä¾›ä¸€ä¸ªä¾èµ–æ•°ç»„ï¼ˆä¹Ÿç§°ä¸ºâ€œdepsâ€ï¼‰å‚æ•°ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">seEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, '</span> <span class="token operator">+</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Our deps</span></code></pre></div>
<p><strong>å°±åƒæˆ‘ä»¬å‘Šè¯‰Reactä¸€æ ·ï¼šâ€œå˜¿ï¼Œæˆ‘çŸ¥é“ä½ çœ‹ä¸åˆ°è¿™ä¸ªå‡½æ•°<em>å†…éƒ¨</em>ï¼Œä½†æˆ‘ä¿è¯å®ƒåªä½¿ç”¨<code class="language-text">name</code>è€Œä¸æ˜¯æ¸²æŸ“ä½œç”¨åŸŸä¸­çš„ä»»ä½•å…¶ä»–å†…å®¹ã€‚â€</strong>  </p>
<p>å¦‚æœè¿™ä¸ªæ•ˆæœåœ¨å½“å‰å’Œä¸Šæ¬¡ä¹‹é—´çš„æ¯ä¸ªå€¼éƒ½ç›¸åŒï¼Œåˆ™æ— æ³•åŒæ­¥ï¼Œå› æ­¤Reactå¯ä»¥è·³è¿‡æ•ˆæœï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function">oldEffect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, Dan'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> oldDeps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Dan'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">newEffect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, Dan'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newDeps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Dan'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre></div>
<p>å¦‚æœç”šè‡³ä¾èµ–é¡¹æ•°ç»„ä¸­çš„ä¸€ä¸ªå€¼åœ¨æ¸²æŸ“ä¹‹é—´æ˜¯ä¸åŒçš„ï¼Œæˆ‘ä»¬çŸ¥é“è¿è¡Œæ•ˆæœä¸èƒ½è¢«è·³è¿‡ã€‚åŒæ­¥æ‰€æœ‰çš„ä¸œè¥¿ï¼</p>
<h2 id="ä¸è¦å› ä¸ºä¾èµ–è€Œæ’’è°"><a href="#%E4%B8%8D%E8%A6%81%E5%9B%A0%E4%B8%BA%E4%BE%9D%E8%B5%96%E8%80%8C%E6%92%92%E8%B0%8E" aria-label="ä¸è¦å› ä¸ºä¾èµ–è€Œæ’’è° permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ä¸è¦å› ä¸ºä¾èµ–è€Œæ’’è°</h2>
<p>åœ¨ä¾èµ–å…³ç³»ä¸Šæ’’è°ä¼šå¸¦æ¥ä¸å¥½çš„åæœã€‚ä»ç›´è§‰ä¸Šçœ‹, è¿™æ˜¯æœ‰é“ç†çš„, ä½†æˆ‘çœ‹åˆ°å‡ ä¹æ¯ä¸ªäººéƒ½å°è¯•ä½¿ç”¨<code class="language-text">useEffect</code>ä¸ç±»ä¸­çš„å¿ƒç†æ¨¡å‹è¯•å›¾æ¬ºéª—è§„åˆ™ã€‚(ä¸€å¼€å§‹æˆ‘ä¹Ÿè¿™ä¹ˆåšäº†!)</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Is this okay? Not always -- and there's a better way to write it.</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>(<a href="https://reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies" target="_blank" rel="nofollow noopener noreferrer">Hook FAQ</a>è§£é‡Šäº†åº”è¯¥æ€ä¹ˆåšã€‚æˆ‘ä»¬å°†åœ¨<a href="https://overreacted.io/a-complete-guide-to-useeffect/#moving-functions-inside-effects" target="_blank" rel="nofollow noopener noreferrer">ä¸‹é¢</a>å›åˆ°è¿™ä¸ªä¾‹å­ã€‚)</p>
<p>â€œä½†æˆ‘åªæƒ³åœ¨mountæ—¶è¿è¡Œå®ƒï¼â€ï¼Œä½ ä¼šè¿™ä¹ˆè¯´ã€‚ç°åœ¨ï¼Œè¯·è®°ä½ï¼šå¦‚æœä½ æŒ‡å®šdepsï¼Œ<strong>ç»„ä»¶å†…éƒ¨çš„æ•ˆæœæ‰€ä½¿ç”¨çš„<em>æ‰€æœ‰</em> å€¼éƒ½ <em>å¿…é¡»</em> åœ¨é‚£é‡Œã€‚</strong> åŒ…æ‹¬propsï¼ŒçŠ¶æ€ï¼Œå‡½æ•° - ç»„ä»¶ä¸­çš„ä»»ä½•å†…å®¹ã€‚</p>
<p>æœ‰æ—¶ï¼Œå½“ä½ è¿™æ ·åšæ—¶ï¼Œå®ƒä¼šå¯¼è‡´é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°ä¸€ä¸ªæ— é™é‡å–å¾ªç¯ï¼Œæˆ–è€…ä¸€ä¸ªsocketè¢«é‡æ–°åˆ›å»ºå¾—å¤ªé¢‘ç¹ã€‚ <strong>è¯¥é—®é¢˜çš„è§£å†³æ–¹æ¡ˆä¸æ˜¯åˆ é™¤ä¾èµ–é¡¹ã€‚</strong> æˆ‘ä»¬å¾ˆå¿«å°±ä¼šçœ‹åˆ°è¿™äº›è§£å†³æ–¹æ¡ˆã€‚</p>
<p>ä½†åœ¨æˆ‘ä»¬è·³åˆ°è§£å†³æ–¹æ¡ˆä¹‹å‰ï¼Œè®©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£é—®é¢˜ã€‚</p>
<h2 id="å½“ä¾èµ–å…³ç³»æ¬ºéª—æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ"><a href="#%E5%BD%93%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB%E6%AC%BA%E9%AA%97%E6%97%B6%E4%BC%9A%E5%8F%91%E7%94%9F%E4%BB%80%E4%B9%88" aria-label="å½“ä¾èµ–å…³ç³»æ¬ºéª—æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>å½“ä¾èµ–å…³ç³»æ¬ºéª—æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ</h2>
<p>å¦‚æœdeps(ä¾èµ–é¡¹)åŒ…å«äº†æ•ˆæœä½¿ç”¨çš„æ‰€æœ‰å€¼ï¼ŒReactçŸ¥é“ä»€ä¹ˆæ—¶å€™é‡æ–°è¿è¡Œå®ƒ:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, '</span> <span class="token operator">+</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å…³æ³¨è¿™ä¸ªä¾èµ–é¡¹</span></code></pre></div>
<p><img src="https://overreacted.io/deps-compare-correct-fae247cd068eedbd4b62ba50592d2b3d.gif"></p>
<p>(<em>ä¾èµ–å…³ç³»æ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡æ–°è¿è¡Œæ•ˆæœã€‚</em>)</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä¸ºæ­¤æ•ˆæœæŒ‡å®šäº†<code class="language-text">[]</code>ï¼Œåˆ™æ–°æ•ˆæœå‡½æ•°å°†ä¸ä¼šè¿è¡Œï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, '</span> <span class="token operator">+</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Wrong: name is missing in deps</span></code></pre></div>
<p><img src="https://overreacted.io/deps-compare-wrong-25f75db3f9f57ffe1426912093577445.gif"></p>
<p>(<em>ä¾èµ–é¡¹æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è·³è¿‡è¿™ä¸ªæ•ˆæœã€‚</em>)</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé—®é¢˜å¯èƒ½æ˜¾è€Œæ˜“è§ã€‚ä½†æ˜¯ï¼Œåœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œå½“ç±»è§£å†³æ–¹æ¡ˆä»ä½ çš„è®°å¿†ä¸­â€œè·³å‡ºâ€æ—¶ï¼Œè¿™ç§ç›´è§‰å¯èƒ½ä¼šæ¬ºéª—ä½ ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æ­£åœ¨ç¼–å†™ä¸€ä¸ªæ¯ç§’é€’å¢ä¸€æ¬¡çš„è®¡æ•°å™¨ã€‚å¯¹äºç±»ï¼Œæˆ‘ä»¬çš„ç›´è§‰æ˜¯ï¼šâ€œè®¾ç½®é—´éš”(interval)ä¸€æ¬¡ï¼Œé”€æ¯é—´éš”ä¸€æ¬¡â€ã€‚è¿™æ˜¯ä¸€ä¸ªæˆ‘ä»¬å¦‚ä½•åšçš„<a href="https://codesandbox.io/s/n5mjzjy9kl" target="_blank" rel="nofollow noopener noreferrer">ä¾‹å­</a>ã€‚å½“æˆ‘ä»¬åœ¨å¿ƒç†ä¸Šå°†æ­¤ä»£ç ç¿»è¯‘ä¸º<code class="language-text">useEffect</code>æ—¶ï¼Œæˆ‘ä»¬æœ¬èƒ½åœ°å°†<code class="language-text">[]</code>æ·»åŠ åˆ°depsä¸­ã€‚â€œæˆ‘æƒ³è®©å®ƒè·‘ä¸€æ¬¡â€ï¼Œå¯¹å—ï¼Ÿ</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ä½ çš„å…³æ³¨ç‚¹åœ¨è¿™é‡Œ</span>

  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ä½†æ˜¯ï¼Œæ­¤ç¤ºä¾‹<a href="https://codesandbox.io/s/91n5z8jo7r" target="_blank" rel="nofollow noopener noreferrer">ä»…é€’å¢ä¸€æ¬¡</a>ã€‚å“å‘€ã€‚</p>
<p>å¦‚æœä½ çš„å¿ƒç†æ¨¡å‹æ˜¯â€œä¾èµ–å…³ç³»è®©æˆ‘æŒ‡å®šä½•æ—¶æˆ‘æƒ³é‡æ–°è§¦å‘æ•ˆæœâ€ï¼Œè¿™ä¸ªä¾‹å­å¯èƒ½ä¼šç»™ä½ ä¸€ä¸ªå­˜åœ¨çš„å±æœºã€‚ä½ æƒ³è¦è§¦å‘å®ƒä¸€æ¬¡ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªé—´éš” - æ‰€ä»¥å®ƒä¸ºä»€ä¹ˆä¼šå¼•èµ·é—®é¢˜ï¼Ÿ</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœä½ çŸ¥é“ä¾èµ–é¡¹æ˜¯æˆ‘ä»¬çš„æç¤ºï¼Œç”¨äºå¯¹æ•ˆæœåœ¨æ¸²æŸ“èŒƒå›´ä¸­ä½¿ç”¨çš„æ‰€æœ‰å†…å®¹ä½œå‡ºååº”ï¼Œé‚£ä¹ˆè¿™æ ·åšæ˜¯æœ‰æ„ä¹‰çš„ã€‚å®ƒä½¿ç”¨<code class="language-text">count</code>ï¼Œä½†æˆ‘ä»¬ä½¿ç”¨<code class="language-text">[]</code>æ’’è°è¯´å®ƒæ²¡æœ‰ä¾èµ–ã€‚å®ƒä¼šå‘é“æˆ‘ä»¬ï¼Œè¿™åªæ˜¯æ—¶é—´é—®é¢˜!</p>
<p>åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­ï¼Œ<code class="language-text">count</code>ä¸º<code class="language-text">0</code>ã€‚å› æ­¤ï¼Œç¬¬ä¸€ä¸ªæ¸²æŸ“æ•ˆæœä¸­çš„<code class="language-text">setCount(count + 1)</code>è¡¨ç¤º<code class="language-text">setCount(0 + 1)</code>ã€‚å› ä¸º<code class="language-text">[]</code> depsæˆ‘ä»¬æ°¸è¿œä¸ä¼šé‡æ–°è¿è¡Œæ•ˆæœï¼Œæ‰€ä»¥å®ƒä¼šæ¯ç§’è°ƒç”¨<code class="language-text">setCount(0 + 1)</code>ï¼š</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// First render, state is 0</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// Effect from first render</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">        <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Always setCount(1)</span></span>      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="gatsby-highlight-code-line">    <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// Never re-runs</span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// Every next render, state is 1</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">    <span class="token comment">// This effect is always ignored because</span></span><span class="gatsby-highlight-code-line">    <span class="token comment">// we lied to React about empty deps.</span></span>    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>æˆ‘ä»¬æ’’è°è¯´æˆ‘ä»¬çš„æ•ˆæœä¸ä¾èµ–äºç»„ä»¶å†…éƒ¨çš„å€¼ï¼Œè€Œå®é™…ä¸Šå®ƒä¾èµ–äºç»„ä»¶å†…éƒ¨çš„å€¼!</p>
<p>æˆ‘ä»¬çš„æ•ˆæœä½¿ç”¨<code class="language-text">count</code> - ç»„ä»¶å†…éƒ¨çš„å€¼ï¼ˆä½†åœ¨æ•ˆæœä¹‹å¤–ï¼‰ï¼š</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="gatsby-highlight-code-line"><span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token comment">// ...</span></span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>å› æ­¤ï¼Œå°†<code class="language-text">[]</code>æŒ‡å®šä¸ºä¾èµ–é¡¹å°†äº§ç”Ÿä¸€ä¸ªé”™è¯¯ã€‚Reactå°†æ¯”è¾ƒä¾èµ–é¡¹ï¼Œå¹¶è·³è¿‡æ›´æ–°æ­¤æ•ˆæœï¼š</p>
<p><img src="https://overreacted.io/interval-wrong-29e53bd0c9b7d2ac70d3cd924886b030.gif"></p>
<p>(<em>ä¾èµ–æ€§æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è·³è¿‡è¿™ä¸ªæ•ˆæœã€‚</em>)</p>
<p>åƒè¿™æ ·çš„é—®é¢˜å¾ˆéš¾æƒ³åˆ°ã€‚å› æ­¤ï¼Œæˆ‘é¼“åŠ±ä½ å°†å…¶ä½œä¸ºä¸€é¡¹ç¡¬æ€§è§„åˆ™ï¼Œå§‹ç»ˆè¯šå®åœ°éµå¾ªæ•ˆæœä¾èµ–å…³ç³»ï¼Œå¹¶å°†å…¶å…¨éƒ¨(æ•ˆæœæ‰€ç”¨åˆ°çš„)æŒ‡å®šã€‚(å¦‚æœä½ æƒ³åœ¨å›¢é˜Ÿä¸­å¼ºåˆ¶æ‰§è¡Œæ­¤æ“ä½œï¼Œæˆ‘ä»¬ä¼šæä¾›ä¸€ä¸ª<a href="%5Blint%20rule%5D(https://github.com/facebook/react/issues/14920)">lintè§„åˆ™</a>ã€‚)</p>
<h2 id="è¯šå®å¯¹å¾…ä¾èµ–å…³ç³»çš„ä¸¤ç§æ–¹æ³•"><a href="#%E8%AF%9A%E5%AE%9E%E5%AF%B9%E5%BE%85%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%B3%95" aria-label="è¯šå®å¯¹å¾…ä¾èµ–å…³ç³»çš„ä¸¤ç§æ–¹æ³• permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>è¯šå®å¯¹å¾…ä¾èµ–å…³ç³»çš„ä¸¤ç§æ–¹æ³•</h2>
<p>æœ‰ä¸¤ç§ç­–ç•¥å¯ä»¥è¯šå®åœ°å¯¹å¾…ä¾èµ–å…³ç³»ã€‚é€šå¸¸åº”è¯¥ä»ç¬¬ä¸€ä¸ªå¼€å§‹ï¼Œç„¶åæ ¹æ®éœ€è¦åº”ç”¨ç¬¬äºŒä¸ªã€‚</p>
<p><strong>ç¬¬ä¸€ç§ç­–ç•¥æ˜¯ä¿®å¤ä¾èµ–å…³ç³»æ•°ç»„ï¼Œä»¥åŒ…å«åœ¨æ•ˆæœä¸­ä½¿ç”¨çš„ç»„ä»¶å†…çš„<em>æ‰€æœ‰</em> å€¼ã€‚</strong> æˆ‘ä»¬å°†<code class="language-text">count</code>ä½œä¸ºdep(ä¾èµ–)åŒ…æ‹¬ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>è¿™ä½¿ä¾èµ–é¡¹æ•°ç»„æ­£ç¡®ã€‚å®ƒå¯èƒ½ä¸å¤ª<em>ç†æƒ³</em>ï¼Œä½†è¿™æ˜¯æˆ‘ä»¬éœ€è¦è§£å†³çš„ç¬¬ä¸€ä¸ªé—®é¢˜ã€‚ç°åœ¨æ”¹å˜<code class="language-text">count</code>å°†é‡æ–°è¿è¡Œæ•ˆæœï¼Œæ¯ä¸€ä¸ªä¸‹ä¸€ä¸ªé—´éš”å¼•ç”¨<code class="language-text">count</code>ä»å…¶æ¸²æŸ“åœ¨<code class="language-text">setCount(count + 1)</code>:</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// First render, state is 0</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// Effect from first render</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">        <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// setCount(count + 1)</span></span>      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="gatsby-highlight-code-line">    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// [count]</span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// Second render, state is 1</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// Effect from second render</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">        <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// setCount(count + 1)</span></span>      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="gatsby-highlight-code-line">    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">// [count]</span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>è¿™æ ·å¯ä»¥<a href="https://codesandbox.io/s/0x0mnlyq8l" target="_blank" rel="nofollow noopener noreferrer">è§£å†³é—®é¢˜</a>ï¼Œä½†åªè¦<code class="language-text">count</code>å‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬çš„é—´éš”å°±ä¼šè¢«æ¸…é™¤å¹¶å†æ¬¡è®¾ç½®ã€‚è¿™å¯èƒ½æ˜¯ä¸å—æ¬¢è¿çš„ï¼š</p>
<p><img src="https://overreacted.io/interval-rightish-5734271ddfa94d2d65ac6160515e0069.gif"></p>
<p>(<em>ä¾èµ–å…³ç³»æ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡æ–°è¿è¡Œæ•ˆæœã€‚</em>)</p>
<hr>
<p><strong>ç¬¬äºŒç§ç­–ç•¥æ˜¯æ›´æ”¹æˆ‘ä»¬çš„effectä»£ç ï¼Œè¿™æ ·å®ƒå°±ä¸éœ€è¦æ¯”æˆ‘ä»¬æƒ³è¦çš„å€¼é¢‘ç¹çš„æ›´æ”¹ã€‚</strong> æˆ‘ä»¬ä¸æƒ³åœ¨ä¾èµ–å…³ç³»ä¸Šæ’’è°â€”â€”æˆ‘ä»¬åªæ˜¯æƒ³æ”¹å˜æˆ‘ä»¬çš„æ•ˆæœï¼Œä½¿ä¾èµ–å…³ç³»<em>æ›´å°‘</em>ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹ä¸€äº›åˆ é™¤ä¾èµ–é¡¹çš„å¸¸ç”¨æŠ€å·§ã€‚</p>
<h2 id="ä½¿æ•ˆæœè‡ªç»™è‡ªè¶³"><a href="#%E4%BD%BF%E6%95%88%E6%9E%9C%E8%87%AA%E7%BB%99%E8%87%AA%E8%B6%B3" aria-label="ä½¿æ•ˆæœè‡ªç»™è‡ªè¶³ permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ä½¿æ•ˆæœè‡ªç»™è‡ªè¶³</h2>
<p>æˆ‘ä»¬å¸Œæœ›æ‘†è„±æ•ˆæœä¸­çš„<code class="language-text">count</code>ä¾èµ–æ€§ã€‚</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦é—®è‡ªå·±ï¼š<strong>æˆ‘ä»¬ä½¿ç”¨<code class="language-text">count</code>ç”¨æ¥åšä»€ä¹ˆï¼Ÿ</strong> å¥½åƒæˆ‘ä»¬åªå°†å®ƒç”¨äº<code class="language-text">setCount</code>è°ƒç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å®é™…ä¸Šåœ¨ä½œç”¨åŸŸé‡Œæ ¹æœ¬ä¸éœ€è¦<code class="language-text">count</code>ã€‚å½“æˆ‘ä»¬æƒ³è¦æ ¹æ®ä»¥å‰çš„çŠ¶æ€æ›´æ–°çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code class="language-text">setState</code>çš„<a href="https://github.com/xiaohesong/TIL/blob/master/front-end/react/hooks/hooks-api.md#%E4%BD%9C%E4%B8%BA%E5%8A%9F%E8%83%BD%E6%9B%B4%E6%96%B0" target="_blank" rel="nofollow noopener noreferrer">å‡½æ•°æ›´æ–°å½¢å¼</a>ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// ä½ çš„å…³æ³¨ç‚¹åœ¨è¿™é‡Œ</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>æˆ‘å–œæ¬¢å°†è¿™äº›æƒ…å†µè§†ä¸ºâ€œé”™è¯¯(å‡çš„)ä¾èµ–â€ã€‚æ˜¯çš„ï¼Œ<code class="language-text">count</code>æ˜¯ä¸€ä¸ªå¿…è¦çš„ä¾èµ–é¡¹ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨æ•ˆæœä¸­ç¼–å†™äº†<code class="language-text">setCount(count + 1)</code>ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬çœŸæ­£çš„éœ€è¦<code class="language-text">count</code>åªæ˜¯å»å°†å…¶è½¬æ¢ä¸º<code class="language-text">count + 1</code>å¹¶å°†å…¶â€œå‘å›â€ç»™Reactã€‚ä½†æ˜¯React<em>å·²ç»çŸ¥é“äº†</em> å½“å‰çš„<code class="language-text">count</code>ã€‚<strong>æˆ‘ä»¬éœ€è¦å‘Šè¯‰Reactçš„æ˜¯å¢åŠ è¿™ä¸ªçŠ¶æ€â€”â€”ä¸ç®¡å®ƒç°åœ¨æ˜¯ä»€ä¹ˆçŠ¶æ€ã€‚</strong> </p>
<p>è¿™æ­£æ˜¯<code class="language-text">setCount(c =&gt; c + 1)</code>çš„ä½œç”¨ã€‚ä½ å¯ä»¥å°†å…¶çœ‹ä½œæ˜¯å‘Reactâ€œå‘é€ä¸€æ¡æŒ‡ä»¤â€æ¥å¯¹çŠ¶æ€åº”è¯¥å¦‚ä½•å˜åŒ–åšå‡ºååº”ã€‚è¿™ç§â€œæ›´æ–°å½¢å¼â€åœ¨å…¶ä»–æƒ…å†µä¸‹ä¹Ÿæœ‰å¸®åŠ©ï¼Œä¾‹å¦‚<a href="https://github.com/xiaohesong/TIL/blob/master/front-end/react/overreact/react%E4%BD%9C%E4%B8%BAui%E8%BF%90%E8%A1%8C.md#batching" target="_blank" rel="nofollow noopener noreferrer">æ‰¹é‡å¤šæ¬¡æ›´æ–°</a>æ—¶ã€‚</p>
<p><strong>è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å®é™…ä¸Šå·²ç»<em>å®Œæˆ</em>äº†åˆ é™¤ä¾èµ–é¡¹çš„å·¥ä½œã€‚æˆ‘ä»¬æ²¡æœ‰æ¬ºéª—ä»–ã€‚æˆ‘ä»¬çš„æ•ˆæœä¸å†ä»æ¸²æŸ“ä½œç”¨åŸŸè¯»å–<code class="language-text">counter</code>å€¼ï¼š</strong> </p>
<p><img src="https://overreacted.io/interval-right-f128ad20c28317ed27a3cb68197fc906.gif"></p>
<p>(<em>ä¾èµ–é¡¹æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è·³è¿‡è¿™ä¸ªæ•ˆæœã€‚</em>)</p>
<p>ä½ å¯ä»¥åœ¨<a href="https://codesandbox.io/s/q3181xz1pj" target="_blank" rel="nofollow noopener noreferrer">è¿™é‡Œ</a>è¯•è¯•ã€‚</p>
<p>å³ä½¿æ­¤æ•ˆæœä»…è¿è¡Œä¸€æ¬¡ï¼Œå±äºç¬¬ä¸€ä¸ªæ¸²æŸ“çš„é—´éš”å›è°ƒå®Œå…¨èƒ½å¤Ÿåœ¨æ¯æ¬¡é—´éš”è§¦å‘æ—¶å‘é€<code class="language-text">c =&gt; c + 1</code>æ›´æ–°æŒ‡ä»¤ã€‚å®ƒä¸å†éœ€è¦çŸ¥é“å½“å‰çš„è®¡æ•°å™¨çŠ¶æ€ã€‚ Reactå·²ç»çŸ¥é“äº†ã€‚</p>
<h2 id="åŠŸèƒ½æ›´æ–°å’Œgoogleæ–‡æ¡£"><a href="#%E5%8A%9F%E8%83%BD%E6%9B%B4%E6%96%B0%E5%92%8Cgoogle%E6%96%87%E6%A1%A3" aria-label="åŠŸèƒ½æ›´æ–°å’Œgoogleæ–‡æ¡£ permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>åŠŸèƒ½æ›´æ–°å’ŒGoogleæ–‡æ¡£</h2>
<p>è¿˜è®°å¾—æˆ‘ä»¬å¦‚ä½•è°ˆè®ºåŒæ­¥æ˜¯æ•ˆæœçš„å¿ƒç†æ¨¡å‹å—ï¼ŸåŒæ­¥çš„ä¸€ä¸ªæœ‰è¶£æ–¹é¢æ˜¯ï¼Œä½ ç»å¸¸å¸Œæœ›ä¿æŒç³»ç»Ÿä¹‹é—´çš„â€œæ¶ˆæ¯â€ä¸å…¶çŠ¶æ€æ— å…³ã€‚ä¾‹å¦‚ï¼Œåœ¨Google Docsä¸­ç¼–è¾‘æ–‡æ¡£å®é™…ä¸Šå¹¶ä¸ä¼šå°†<em>æ•´ä¸ª</em>é¡µé¢å‘é€åˆ°æœåŠ¡å™¨ã€‚é‚£å°†æ˜¯éå¸¸ä½æ•ˆçš„ã€‚ç›¸åï¼Œå®ƒä¼šå‘é€ç”¨æˆ·å°è¯•æ‰§è¡Œæ“ä½œçš„è¡¨ç¤ºã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬çš„ç”¨ä¾‹æ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯ç±»ä¼¼çš„å“²å­¦é€‚ç”¨äºæ•ˆæœã€‚<strong>å®ƒåªæœ‰åŠ©äºå°†æœ€å°‘çš„å¿…è¦ä¿¡æ¯ä»æ•ˆæœå†…éƒ¨å‘é€åˆ°ç»„ä»¶ã€‚</strong> åƒ<code class="language-text">setCount(c =&gt; c + 1)</code>è¿™æ ·çš„æ›´æ–°å½¢å¼ä¼ é€’çš„ä¿¡æ¯ä¸¥æ ¼å°‘äº<code class="language-text">setCount(count + 1)</code>ï¼Œå› ä¸ºå®ƒæ²¡æœ‰è¢«å½“å‰è®¡æ•°(count)â€œæ±¡æŸ“â€ã€‚å®ƒåªè¡¨ç¤ºåŠ¨ä½œ(â€œé€’å¢â€)ã€‚åœ¨Reactä¸­æ€è€ƒæ¶‰åŠåˆ°<a href="https://reactjs.org/docs/thinking-in-react.html#step-3-identify-the-minimal-but-complete-representation-of-ui-state" target="_blank" rel="nofollow noopener noreferrer">æ‰¾åˆ°æœ€å°çš„çŠ¶æ€</a>ã€‚è¿™æ˜¯ç›¸åŒçš„åŸåˆ™ï¼Œä½†å¯¹äºæ›´æ–°ã€‚</p>
<p>ç¼–ç æ„å›¾(è€Œä¸æ˜¯ç»“æœ)ç±»ä¼¼äºè°·æ­Œæ–‡æ¡£<a href="https://medium.com/@srijancse/how-real-time-collaborative-editing-work-operational-transformation-ac4902d75682" target="_blank" rel="nofollow noopener noreferrer">è§£å†³</a>åä½œç¼–è¾‘çš„æ–¹å¼ã€‚è™½ç„¶è¿™æ˜¯å»¶ä¼¸çš„ç±»æ¯”ï¼Œä½†åŠŸèƒ½æ›´æ–°åœ¨Reactä¸­ä¹Ÿæ‰®æ¼”ç€ç±»ä¼¼çš„è§’è‰²ã€‚å®ƒä»¬ç¡®ä¿æ¥è‡ªå¤šä¸ªæºçš„æ›´æ–°(äº‹ä»¶å¤„ç†ç¨‹åºã€æ•ˆæœè®¢é˜…ç­‰)èƒ½å¤Ÿä»¥å¯é¢„æµ‹çš„æ–¹å¼æ­£ç¡®åœ°åº”ç”¨äºæ‰¹å¤„ç†ä¸­ã€‚</p>
<p><strong>ä½†æ˜¯ï¼Œå³ä½¿æ˜¯<code class="language-text">setCount(c =&gt; c + 1)</code>ä¹Ÿä¸æ˜¯é‚£ä¹ˆå¥½ã€‚</strong> å®ƒçœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ªï¼Œå®ƒèƒ½åšçš„éå¸¸æœ‰é™ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸¤ä¸ªçŠ¶æ€å˜é‡ï¼Œå®ƒä»¬çš„å€¼ç›¸äº’ä¾èµ–ï¼Œæˆ–è€…å¦‚æœæˆ‘ä»¬éœ€è¦æ ¹æ®propæ¥è®¡ç®—ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œè¿™å¯¹æˆ‘ä»¬æ²¡æœ‰å¸®åŠ©ã€‚å¹¸è¿çš„æ˜¯ï¼Œ<code class="language-text">setCount(c =&gt; c + 1)</code>æœ‰ä¸€ä¸ªæ›´å¼ºå¤§çš„å§å¦¹æ¨¡å¼ã€‚å®ƒçš„åç§°æ˜¯<code class="language-text">useReducer</code>ã€‚</p>
<h2 id="å°†æ›´æ–°ä¸æ“ä½œè§£è€¦"><a href="#%E5%B0%86%E6%9B%B4%E6%96%B0%E4%B8%8E%E6%93%8D%E4%BD%9C%E8%A7%A3%E8%80%A6" aria-label="å°†æ›´æ–°ä¸æ“ä½œè§£è€¦ permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>å°†æ›´æ–°ä¸æ“ä½œè§£è€¦</h2>
<p>è®©æˆ‘ä»¬ä¿®æ”¹å‰é¢çš„ä¾‹å­ï¼Œè®©å®ƒæœ‰ä¸¤ä¸ªçŠ¶æ€å˜é‡ï¼š<code class="language-text">count</code>å’Œ<code class="language-text">step</code>ã€‚æˆ‘ä»¬çš„é—´éš”å°†ä½¿<code class="language-text">count</code>å¢åŠ <code class="language-text">step</code>è¾“å…¥çš„å€¼ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>step<span class="token punctuation">,</span> setStep<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setCount</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c <span class="token operator">+</span> step<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>step<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>step<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>e <span class="token operator">=></span> <span class="token function">setStep</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>(è¿™é‡Œæ˜¯ä¸€ä¸ª<a href="https://codesandbox.io/s/zxn70rnkx" target="_blank" rel="nofollow noopener noreferrer">ä¾‹å­</a>)</p>
<p>è¯·æ³¨æ„ï¼Œ<strong>æˆ‘ä»¬æ²¡æœ‰æ¬ºéª—ã€‚</strong> ç”±äºæˆ‘å¼€å§‹åœ¨æ•ˆæœä¸­ä½¿ç”¨stepï¼Œæˆ‘å°†å®ƒæ·»åŠ åˆ°ä¾èµ–é¡¹ä¸­ã€‚è¿™å°±æ˜¯ä»£ç æ­£ç¡®è¿è¡Œçš„åŸå› ã€‚</p>
<p>æ­¤ç¤ºä¾‹ä¸­çš„å½“å‰è¡Œä¸ºæ˜¯æ›´æ”¹<code class="language-text">step</code>é‡æ–°å¯åŠ¨é—´éš” - å› ä¸ºå®ƒæ˜¯å…¶ä¸­ä¸€ä¸ªä¾èµ–é¡¹ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œè¿™æ­£æ˜¯ä½ æƒ³è¦çš„ï¼æ‹†é™¤ä¸€ä¸ªæ•ˆæœå¹¶é‡æ–°è®¾ç½®å®ƒæ²¡æœ‰é”™ï¼Œé™¤éæˆ‘ä»¬æœ‰å¾ˆå¥½çš„ç†ç”±ï¼Œå¦åˆ™æˆ‘ä»¬ä¸åº”è¯¥é¿å…è¿™æ ·åšã€‚</p>
<p>ä½†æ˜¯ï¼Œå‡è®¾æˆ‘ä»¬å¸Œæœ›é—´éš”æ—¶é’Ÿä¸ä¼šåœ¨<code class="language-text">step</code>æ›´æ”¹æ—¶é‡ç½®ã€‚æˆ‘ä»¬å¦‚ä½•ä»æ•ˆæœä¸­åˆ é™¤<code class="language-text">step</code>ä¾èµ–ï¼Ÿ</p>
<p><strong>è®¾ç½®çŠ¶æ€å˜é‡æ—¶ï¼Œå–å†³äºå¦ä¸€ä¸ªçŠ¶æ€å˜é‡çš„å½“å‰å€¼ï¼Œä½ å¯èƒ½å¸Œæœ›å°è¯•ä½¿ç”¨<code class="language-text">useReducer</code>æ›¿æ¢å®ƒä»¬ã€‚</strong> </p>
<p>å½“ä½ å‘ç°è‡ªå·±æ­£åœ¨ç¼–å†™<code class="language-text">setSomething(something =&gt;â€¦)</code>æ—¶ï¼Œæ˜¯æ—¶å€™è€ƒè™‘ä½¿ç”¨reduceräº†ã€‚reducerå…è®¸ä½  <strong>å°†è¡¨ç¤ºç»„ä»¶ä¸­å‘ç”Ÿçš„â€œæ“ä½œâ€ä¸çŠ¶æ€æ›´æ–°çš„å“åº”æ–¹å¼è§£è€¦ã€‚</strong></p>
<p>åœ¨æˆ‘ä»¬çš„æ•ˆæœä¸­ï¼Œè®©æˆ‘ä»¬å°†<code class="language-text">step</code>ä¾èµ–å…³ç³»æ›¿æ¢ä¸º<code class="language-text">dispatch</code>ä¾èµ–å…³ç³»:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> step <span class="token punctuation">}</span> <span class="token operator">=</span> state<span class="token punctuation">;</span>

<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'tick'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Instead of setCount(c => c + step);</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dispatch<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>(æŸ¥çœ‹è¿™é‡Œ<a href="https://codesandbox.io/s/xzr480k0np" target="_blank" rel="nofollow noopener noreferrer">ä¾‹å­</a>)</p>
<p>ä½ å¯èƒ½ä¼šé—®æˆ‘ï¼šâ€œè¿™æ€ä¹ˆä¼šæ›´å¥½ï¼Ÿâ€ç­”æ¡ˆæ˜¯ <strong>Reactä¿è¯<code class="language-text">dispatch</code>å‡½æ•°åœ¨æ•´ä¸ªç»„ä»¶ç”Ÿå‘½å‘¨æœŸå†…ä¿æŒä¸å˜ã€‚æ‰€ä»¥ä¸Šé¢çš„ä¾‹å­ä¸éœ€è¦é‡æ–°è®¢é˜…é—´éš”ã€‚</strong> </p>
<p>æˆ‘ä»¬è§£å†³äº†é—®é¢˜ï¼</p>
<p>(<em>ä½ å¯ä»¥çœç•¥depsä¸­çš„<code class="language-text">dispatch</code>ï¼Œ<code class="language-text">setState</code>å’Œ<code class="language-text">useRef</code>å®¹å™¨å€¼ï¼Œå› ä¸ºReactä¿è¯å®ƒä»¬æ˜¯é™æ€çš„ã€‚ä½†æŒ‡å®šå®ƒä»¬ä¹Ÿæ²¡æœ‰åå¤„ã€‚</em>)</p>
<p>å®ƒä¸æ˜¯åœ¨æ•ˆæœä¸­è¯»å–çŠ¶æ€ï¼Œè€Œæ˜¯å‘é€ä¸€ä¸ªåŠ¨ä½œæ¥ç¼–ç  <em>å‘ç”Ÿäº†ä»€ä¹ˆ</em> çš„ä¿¡æ¯ã€‚è¿™å…è®¸æˆ‘ä»¬çš„æ•ˆæœä¿æŒä¸<code class="language-text">step</code>çŠ¶æ€è§£è€¦ã€‚æˆ‘ä»¬çš„æ•ˆæœå¹¶ä¸å…³å¿ƒæˆ‘ä»¬å¦‚ä½•æ›´æ–°çŠ¶æ€ï¼Œå®ƒåªæ˜¯å‘Šè¯‰æˆ‘ä»¬<em>å‘ç”Ÿäº†ä»€ä¹ˆ</em>ã€‚reduceré›†ä¸­äº†æ›´æ–°é€»è¾‘ï¼š</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
  count<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  step<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> step <span class="token punctuation">}</span> <span class="token operator">=</span> state<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'tick'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> count <span class="token operator">+</span> step<span class="token punctuation">,</span> step <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'step'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> step<span class="token punctuation">:</span> action<span class="token punctuation">.</span>step <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>(å¦‚æœä½ ä¹‹å‰é”™è¿‡äº†ï¼Œé‚£ä¹ˆè¿™æ˜¯ä¸€ä¸ª<a href="https://codesandbox.io/s/xzr480k0np" target="_blank" rel="nofollow noopener noreferrer">æ¼”ç¤º</a>)</p>
<h2 id="ä¸ºä»€ä¹ˆusereduceræ˜¯hooksçš„æ¬ºéª—æ¨¡å¼"><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88usereducer%E6%98%AFhooks%E7%9A%84%E6%AC%BA%E9%AA%97%E6%A8%A1%E5%BC%8F" aria-label="ä¸ºä»€ä¹ˆusereduceræ˜¯hooksçš„æ¬ºéª—æ¨¡å¼ permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ä¸ºä»€ä¹ˆuseReduceræ˜¯Hooksçš„æ¬ºéª—æ¨¡å¼</h2>
<p>æˆ‘ä»¬å·²ç»çœ‹åˆ°å½“æ•ˆæœéœ€è¦æ ¹æ®ä»¥å‰çš„çŠ¶æ€æˆ–å¦ä¸€ä¸ªçŠ¶æ€å˜é‡è®¾ç½®çŠ¶æ€æ—¶å¦‚ä½•åˆ é™¤ä¾èµ–å…³ç³»ã€‚<strong>ä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦propsæ¥è®¡ç®—ä¸‹ä¸€ä¸ªçŠ¶æ€å‘¢ï¼Ÿ</strong> ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„APIå¯èƒ½æ˜¯<code class="language-text">&lt;Counter step = {1} /&gt;</code>ã€‚å½“ç„¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸èƒ½é¿å…å°†<code class="language-text">props.step</code>æŒ‡å®šä¸ºä¾èµ–é¡¹ï¼Ÿ</p>
<p>äº‹å®ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ï¼æˆ‘ä»¬å¯ä»¥å°†<em>reduceræœ¬èº«</em> æ”¾åœ¨æˆ‘ä»¬çš„ç»„ä»¶ä¸­æ¥è¯»å–propsï¼š </p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> step <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'tick'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ä½ çš„å…³æ³¨ç‚¹åº”è¯¥åœ¨è¿™é‡Œ</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> step<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'tick'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dispatch<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>è¿™ä¸ªæ¨¡å¼ç¦ç”¨äº†ä¸€äº›ä¼˜åŒ–ï¼Œæ‰€ä»¥å°½é‡ä¸è¦åœ¨ä»»ä½•åœ°æ–¹éƒ½ä½¿ç”¨å®ƒï¼Œä½†æ˜¯å¦‚æœéœ€è¦ï¼Œä½ å¯ä»¥å®Œå…¨ä»reducerè®¿é—®propsã€‚(è¿™é‡Œæ˜¯ä¸€ä¸ª<a href="https://codesandbox.io/s/7ypm405o8q" target="_blank" rel="nofollow noopener noreferrer">ä¾‹å­</a>)</p>
<p><strong>å³ä½¿åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé‡æ–°æ¸²æŸ“ä¹‹é—´ä»ç„¶ä¿è¯<code class="language-text">dispatch</code>æ ‡è¯†æ˜¯ç¨³å®šçš„ã€‚</strong> å› æ­¤ï¼Œå¦‚æœéœ€è¦ï¼Œä½ å¯ä»¥ä»æ•ˆæœdepsä¸­çœç•¥å®ƒã€‚å®ƒä¸ä¼šå¯¼è‡´é‡æ–°è¿è¡Œæ•ˆæœã€‚</p>
<p>ä½ å¯èƒ½æƒ³çŸ¥é“ï¼šè¿™æ€ä¹ˆå¯èƒ½æœ‰æ•ˆå‘¢ï¼Ÿå½“ä»å±äºå¦ä¸€ä¸ªæ¸²æŸ“æ•ˆæœçš„å†…éƒ¨è°ƒç”¨æ—¶ï¼Œreducerå¦‚ä½•â€œçŸ¥é“â€props?ç­”æ¡ˆæ˜¯ï¼Œå½“ä½ <code class="language-text">dispatch</code>æ—¶ï¼ŒReactä¼šè®°ä½è¯¥æ“ä½œ - ä½†å®ƒä¼šåœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æœŸé—´è°ƒç”¨ä½ çš„reducerã€‚åœ¨é‚£æ—¶ï¼Œæ–°çš„propså°†åœ¨ä½œç”¨åŸŸå†…ï¼Œä½ ä¸ä¼šåœ¨ä¸€ä¸ªæ•ˆæœå†…ã€‚</p>
<p><strong>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘å–œæ¬¢å°†<code class="language-text">useReducer</code>è§†ä¸ºHooksçš„â€œä½œå¼Š(æ¬ºéª—)æ¨¡å¼â€ã€‚å®ƒè®©æˆ‘å°†æ›´æ–°é€»è¾‘ä»æè¿°æ‰€å‘ç”Ÿçš„äº‹æƒ…ä¸­è§£è€¦å‡ºæ¥ã€‚åè¿‡æ¥ï¼Œè¿™æœ‰åŠ©äºæˆ‘ä»æˆ‘çš„æ•ˆæœä¸­åˆ é™¤ä¸å¿…è¦çš„ä¾èµ–é¡¹ï¼Œå¹¶é¿å…æ›´é¢‘ç¹åœ°é‡æ–°è¿è¡Œå®ƒä»¬ã€‚</strong>  </p>
<h2 id="ç§»åŠ¨å‡½æ•°åˆ°æ•ˆæœå†…"><a href="#%E7%A7%BB%E5%8A%A8%E5%87%BD%E6%95%B0%E5%88%B0%E6%95%88%E6%9E%9C%E5%86%85" aria-label="ç§»åŠ¨å‡½æ•°åˆ°æ•ˆæœå†… permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ç§»åŠ¨å‡½æ•°åˆ°æ•ˆæœå†…</h2>
<p>ä¸€ä¸ªå¸¸è§çš„é”™è¯¯æ˜¯è®¤ä¸ºå‡½æ•°ä¸åº”è¯¥æ˜¯ä¾èµ–å…³ç³»ã€‚ä¾‹å¦‚ï¼Œè¿™ä¼¼ä¹å¯ä»¥å·¥ä½œï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hits<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span>
      <span class="token string">'https://hn.algolia.com/api/v1/search?query=react'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Is this okay?</span>
  <span class="token comment">// ...</span></code></pre></div>
<p>(<em><a href="https://codesandbox.io/s/8j4ykjyv0" target="_blank" rel="nofollow noopener noreferrer">è¿™ä¸ªä¾‹å­</a>æ”¹ç¼–è‡ªRobin Wieruchçš„ä¸€ç¯‡ç²¾å½©æ–‡ç«  - <a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="nofollow noopener noreferrer">çœ‹çœ‹å§</a>ï¼</em>)</p>
<p>éœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œæ­¤ä»£ç ç¡®å®æœ‰æ•ˆã€‚<strong>ä½†æ˜¯ç®€å•åœ°å¿½ç•¥å±€éƒ¨å‡½æ•°çš„é—®é¢˜æ˜¯ï¼Œå½“ç»„ä»¶å¢é•¿æ—¶ï¼Œå¾ˆéš¾åˆ¤æ–­æˆ‘ä»¬æ˜¯å¦åœ¨å¤„ç†æ‰€æœ‰çš„æƒ…å†µ!</strong> </p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„ä»£ç æ˜¯è¿™æ ·æ‹†åˆ†çš„ï¼Œæ¯ä¸ªå‡½æ•°éƒ½è¦å¤§(å¾ˆé•¿ï¼Œä¸æ˜“ç»´æŠ¤)äº”å€ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Imagine this function is long</span>
  <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query=react'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Imagine this function is also long</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç°åœ¨è®©æˆ‘ä»¬è¯´æˆ‘ä»¬ç¨ååœ¨å…¶ä¸­ä¸€ä¸ªå‡½æ•°ä¸­ä½¿ç”¨ä¸€äº›çŠ¶æ€æˆ–propï¼š</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Imagine this function is also long</span>
  <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span></span>  <span class="token punctuation">}</span>

  <span class="token comment">// Imagine this function is also long</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å¦‚æœæˆ‘ä»¬å¿˜è®°æ›´æ–°è°ƒç”¨è¿™äº›å‡½æ•°çš„ä»»ä½•æ•ˆæœçš„deps(å¯èƒ½é€šè¿‡å…¶ä»–å‡½æ•°ï¼)ï¼Œæˆ‘ä»¬çš„æ•ˆæœå°†æ— æ³•åŒæ­¥æ¥è‡ªpropså’Œstateçš„æ›´æ”¹ã€‚è¿™å¬èµ·æ¥ä¸å¤ªå¥½ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œè¿™ä¸ªé—®é¢˜æœ‰ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚<strong>å¦‚æœä½ åªåœ¨æ•ˆæœä¸­ä½¿ç”¨æŸäº›å‡½æ•°ï¼Œè¯·å°†å®ƒä»¬ç›´æ¥ç§»åŠ¨åˆ°è¯¥æ•ˆæœä¸­ï¼š</strong> </p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// ä½ çš„å…³æ³¨ç‚¹åœ¨è¿™é‡Œ</span>
    <span class="token comment">// We moved these functions inside!</span>
    <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query=react'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… Deps are OK</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>(<a href="https://codesandbox.io/s/04kp3jwwql" target="_blank" rel="nofollow noopener noreferrer">è¿™é‡Œæ˜¯ä¸€ä¸ªç¤ºä¾‹</a>)</p>
<p>é‚£ä¹ˆæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿæˆ‘ä»¬ä¸å†éœ€è¦è€ƒè™‘â€œä¼ é€’ä¾èµ–â€ã€‚æˆ‘ä»¬çš„ä¾èµ–æ•°ç»„ä¸å†æ¬ºéª—ä½ : <strong>æˆ‘ä»¬çœŸçš„æ²¡æœ‰åœ¨æˆ‘ä»¬çš„æ•ˆæœä¸­ä½¿ç”¨æ¥è‡ªç»„ä»¶å¤–éƒ¨ä½œç”¨åŸŸçš„ä»»ä½•ä¸œè¥¿ã€‚</strong> </p>
<p>å¦‚æœæˆ‘ä»¬ç¨åä¿®æ”¹<code class="language-text">getFetchUrl</code>ä»¥ä½¿ç”¨<code class="language-text">query</code>çŠ¶æ€ï¼Œæˆ‘ä»¬æ›´æœ‰å¯èƒ½æ³¨æ„åˆ°æˆ‘ä»¬åœ¨æ•ˆæœ<em>ä¸­</em>ç¼–è¾‘å®ƒ - å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å‘æ•ˆæœä¾èµ–é¡¹æ·»åŠ <code class="language-text">query</code>ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>query<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… Deps are OK</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>(è¿™é‡Œæ˜¯ä¸€ä¸ª<a href="https://codesandbox.io/s/pwm32zx7z7" target="_blank" rel="nofollow noopener noreferrer">ä¾‹å­</a>)</p>
<p>é€šè¿‡æ·»åŠ æ­¤ä¾èµ–é¡¹ï¼Œæˆ‘ä»¬ä¸ä»…ä»…æ˜¯â€œå®‰æŠšReactâ€ã€‚å½“<code class="language-text">query</code>å‘ç”Ÿæ›´æ”¹æ—¶ï¼Œé‡æ–°è·å–æ•°æ®æ˜¯æœ‰æ„ä¹‰çš„ã€‚<strong><code class="language-text">useEffect</code>çš„è®¾è®¡è¿«ä½¿ä½ æ³¨æ„åˆ°æˆ‘ä»¬çš„æ•°æ®æµä¸­çš„å˜åŒ–ï¼Œå¹¶é€‰æ‹©æˆ‘ä»¬çš„æ•ˆæœåº”è¯¥å¦‚ä½•åŒæ­¥å®ƒâ€”â€”è€Œä¸æ˜¯å¿½ç•¥å®ƒï¼Œç›´åˆ°æˆ‘ä»¬çš„äº§å“ç”¨æˆ·é‡åˆ°bugã€‚</strong> </p>
<p>æ„Ÿè°¢<code class="language-text">eslint-plugin-react-hooks</code>æ’ä»¶ä¸­çš„<code class="language-text">exhaustive-deps</code> lintè§„åˆ™ï¼Œä½ å¯ä»¥<a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="nofollow noopener noreferrer">åœ¨ç¼–è¾‘å™¨ä¸­è¾“å…¥æ—¶åˆ†ææ•ˆæœ</a>ï¼Œå¹¶è·å¾—æœ‰å…³ç¼ºå°‘å“ªäº›ä¾èµ–é¡¹çš„å»ºè®®ã€‚æ¢å¥è¯è¯´ï¼Œè®¡ç®—æœºå¯ä»¥å‘Šè¯‰ä½ ç»„ä»¶æœªæ­£ç¡®å¤„ç†å“ªäº›æ•°æ®æµæ›´æ”¹ã€‚</p>
<p><img src="https://overreacted.io/exhaustive-deps-04a90dcbacb01105d634964880ebed19.gif"></p>
<p>å¾ˆç”œèœœã€‚</p>
<h2 id="ä½†æˆ‘ä¸èƒ½æŠŠè¿™ä¸ªå‡½æ•°æ”¾åœ¨ä¸€ä¸ªæ•ˆæœä¸­"><a href="#%E4%BD%86%E6%88%91%E4%B8%8D%E8%83%BD%E6%8A%8A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E6%94%BE%E5%9C%A8%E4%B8%80%E4%B8%AA%E6%95%88%E6%9E%9C%E4%B8%AD" aria-label="ä½†æˆ‘ä¸èƒ½æŠŠè¿™ä¸ªå‡½æ•°æ”¾åœ¨ä¸€ä¸ªæ•ˆæœä¸­ permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ä½†æˆ‘ä¸èƒ½æŠŠè¿™ä¸ªå‡½æ•°æ”¾åœ¨ä¸€ä¸ªæ•ˆæœä¸­</h2>
<p>æœ‰æ—¶ä½ å¯èƒ½ä¸æƒ³æŠŠå‡½æ•°ç§»åˆ°æ•ˆæœ<em>ä¸­</em>ã€‚ä¾‹å¦‚ï¼ŒåŒä¸€ç»„ä»¶ä¸­çš„å¤šä¸ªæ•ˆæœå¯èƒ½ä¼šè°ƒç”¨ç›¸åŒçš„å‡½æ•°ï¼Œå¹¶ä¸”ä½ ä¸å¸Œæœ›å¤åˆ¶å’Œç²˜è´´å…¶é€»è¾‘ã€‚æˆ–è®¸è¿™æ˜¯ä¸€ä¸ªpropã€‚</p>
<p>ä½ åº”è¯¥åœ¨æ•ˆæœä¾èµ–ä¸­è·³è¿‡è¿™æ ·çš„å‡½æ•°å—ï¼Ÿæˆ‘æƒ³ä¸æ˜¯ã€‚åŒæ ·ï¼Œ<strong>æ•ˆæœä¸åº”è¯¥åœ¨ä¾èµ–å…³ç³»ä¸Šæ’’è°ã€‚</strong> é€šå¸¸æœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚ä¸€ä¸ªå¸¸è§çš„è¯¯è§£æ˜¯â€œä¸€ä¸ªå‡½æ•°æ°¸è¿œä¸ä¼šæ”¹å˜â€ã€‚ä½†æ­£å¦‚æˆ‘ä»¬åœ¨æ•´ç¯‡æ–‡ç« ä¸­æ‰€å­¦åˆ°çš„ï¼Œè¿™ä¸å¯èƒ½æ˜¯äº‹å®ã€‚å®é™…ä¸Šï¼Œç»„ä»¶å†…å®šä¹‰çš„å‡½æ•°ä¼šåœ¨æ¯ä¸ªæ¸²æŸ“ä¸­å‘ç”Ÿå˜åŒ–ï¼</p>
<p><strong>è¿™æœ¬èº«å°±æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚</strong> å‡è®¾ä¸¤ä¸ªæ•ˆæœè°ƒç”¨<code class="language-text">getFetchUrl</code>ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... Fetch data and do something ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ”´ Missing dep: getFetchUrl</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'redux'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... Fetch data and do something ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ”´ Missing dep: getFetchUrl</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¸å¸Œæœ›åœ¨ä»»ä½•ä¸€ä¸ªæ•ˆæœä¸­ç§»åŠ¨<code class="language-text">getFetchUrl</code>ï¼Œå› ä¸ºè¿™æ ·ä½ å°±æ— æ³•å…±äº«é€»è¾‘ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä½ å¯¹æ•ˆæœä¾èµ–æ€§â€œè¯šå®â€ï¼Œåˆ™å¯èƒ½ä¼šé‡åˆ°é—®é¢˜ã€‚ç”±äºæˆ‘ä»¬çš„æ•ˆæœéƒ½ä¾èµ–äº<code class="language-text">getFetchUrl</code>ï¼ˆ<strong>æ¯ä¸ªæ¸²æŸ“éƒ½ä¸åŒ</strong> ï¼‰ï¼Œæˆ‘ä»¬çš„ä¾èµ–æ•°ç»„æ˜¯æ— ç”¨çš„ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ğŸ”´ Re-triggers all effects on every render</span>
  <span class="token comment">// ä½ çš„å…³æ³¨ç‚¹åœ¨è¿™é‡Œ</span>
  <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... Fetch data and do something ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getFetchUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸš§ Deps are correct but they change too often</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'redux'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... Fetch data and do something ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getFetchUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸš§ Deps are correct but they change too often</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ä¸€ä¸ªè¯±äººçš„è§£å†³æ–¹æ¡ˆæ˜¯ç›´æ¥è·³è¿‡depsåˆ—è¡¨ä¸­çš„<code class="language-text">getFetchUrl</code>å‡½æ•°ã€‚ä½†æ˜¯ï¼Œæˆ‘ä¸è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆã€‚è¿™ä½¿æˆ‘ä»¬å¾ˆéš¾æ³¨æ„åˆ°ä½•æ—¶å‘æ•°æ®æµæ·»åŠ <em>éœ€è¦</em>ç”±æ•ˆæœå¤„ç†çš„æ›´æ”¹ã€‚è¿™ä¼šå¯¼è‡´æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„â€œæ°¸ä¸æ›´æ–°é—´éš”(interval)â€ç­‰é”™è¯¯ã€‚</p>
<p>ç›¸åï¼Œè¿˜æœ‰å¦å¤–ä¸¤ç§æ›´ç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p><strong>é¦–å…ˆï¼Œå¦‚æœå‡½æ•°ä¸ä½¿ç”¨ç»„ä»¶èŒƒå›´ä¸­çš„ä»»ä½•å†…å®¹ï¼Œä½ å¯ä»¥å°†å…¶æå‡åˆ°ç»„ä»¶å¤–éƒ¨ï¼Œç„¶ååœ¨æ•ˆæœä¸­è‡ªç”±ä½¿ç”¨å®ƒï¼š</strong> </p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// âœ… Not affected by the data flow</span>
<span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... Fetch data and do something ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… Deps are OK</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'redux'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... Fetch data and do something ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… Deps are OK</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>æ— éœ€åœ¨depsä¸­æŒ‡å®šå®ƒï¼Œå› ä¸ºå®ƒä¸åœ¨æ¸²æŸ“èŒƒå›´å†…ï¼Œå¹¶ä¸”ä¸å—æ•°æ®æµçš„å½±å“ã€‚å®ƒä¸èƒ½å¶ç„¶åœ°ä¾èµ–äºpropsæˆ–çŠ¶æ€ã€‚</p>
<p>æˆ–è€…ï¼Œä½ å¯ä»¥å°†å…¶åŒ…è£…åˆ°<a href="https://github.com/xiaohesong/TIL/blob/master/front-end/react/hooks/hooks-api.md#usecallback" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">useCallback</code> Hook</a>ä¸­ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// âœ… Preserves identity when its own deps are the same</span>
  <span class="token comment">// ä½ çš„å…³æ³¨ç‚¹åœ¨è¿™é‡Œ</span>
  <span class="token keyword">const</span> getFetchUrl <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// âœ… Callback deps are OK</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... Fetch data and do something ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getFetchUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… Effect deps are OK</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'redux'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... Fetch data and do something ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getFetchUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… Effect deps are OK</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p><code class="language-text">useCallback</code>å®é™…ä¸Šå°±åƒæ·»åŠ å¦ä¸€å±‚ä¾èµ–æ€§æ£€æŸ¥ã€‚å®ƒæ­£åœ¨å¦ä¸€ç«¯è§£å†³é—®é¢˜ â€” <strong>æˆ‘ä»¬åªåœ¨å¿…è¦æ—¶æ›´æ”¹å‡½æ•°æœ¬èº«ï¼Œè€Œä¸æ˜¯é¿å…å‡½æ•°ä¾èµ–ã€‚</strong> </p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹ä¸ºä»€ä¹ˆè¿™ç§æ–¹æ³•å¾ˆæœ‰ç”¨ã€‚ä»¥å‰ï¼Œæˆ‘ä»¬çš„ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸¤ä¸ªæœç´¢ç»“æœï¼ˆé’ˆå¯¹<code class="language-text">&#39;react&#39;</code>å’Œ<code class="language-text">&#39;redux&#39;</code>æœç´¢æŸ¥è¯¢ï¼‰ã€‚ä½†æ˜¯ï¼Œå‡è®¾æˆ‘ä»¬è¦æ·»åŠ ä¸€ä¸ªè¾“å…¥ï¼Œä»¥ä¾¿å¯ä»¥æœç´¢ä»»æ„<code class="language-text">query</code>ã€‚å› æ­¤ï¼Œ<code class="language-text">getFetchUrl</code>ç°åœ¨ä¸ä¼šå°†<code class="language-text">query</code>ä½œä¸ºå‚æ•°ï¼Œè€Œæ˜¯ä»æœ¬åœ°çŠ¶æ€è¯»å–å®ƒã€‚</p>
<p>æˆ‘ä»¬ä¼šç«‹å³çœ‹åˆ°å®ƒç¼ºå°‘<code class="language-text">query</code>ä¾èµ–é¡¹ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> getFetchUrl <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> <span class="token comment">// No query argument</span>
    <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ”´ Missing dep: query</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å¦‚æœæˆ‘ä¿®å¤äº†<code class="language-text">useCallback</code> depsä»¥åŒ…å«<code class="language-text">query</code>ï¼Œé‚£ä¹ˆæ¯å½“<code class="language-text">query</code>æ›´æ”¹æ—¶ï¼Œdepsä¸­çš„<code class="language-text">getFetchUrl</code>çš„ä»»ä½•æ•ˆæœéƒ½ä¼šé‡æ–°è¿è¡Œï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// âœ… Preserves identity until query changes</span>
  <span class="token keyword">const</span> getFetchUrl <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>query<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// âœ… Callback deps are OK</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... Fetch data and do something ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getFetchUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… Effect deps are OK</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>æ„Ÿè°¢<code class="language-text">useCallback</code>ï¼Œå¦‚æœ<code class="language-text">query</code>ç›¸åŒï¼Œåˆ™<code class="language-text">getFetchUrl</code>ä¹Ÿä¿æŒä¸å˜ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„æ•ˆæœä¸ä¼šé‡æ–°è¿è¡Œã€‚ä½†æ˜¯å¦‚æœ<code class="language-text">query</code>æ›´æ”¹ï¼Œ<code class="language-text">getFetchUrl</code>ä¹Ÿä¼šæ›´æ”¹ï¼Œæˆ‘ä»¬å°†é‡æ–°è·å–æ•°æ®ã€‚è¿™å¾ˆåƒåœ¨Excelç”µå­è¡¨æ ¼ä¸­æ›´æ”¹æŸäº›å•å…ƒæ ¼æ—¶ï¼Œä½¿ç”¨å®ƒçš„å…¶ä»–å•å…ƒæ ¼ä¼šè‡ªåŠ¨é‡æ–°è®¡ç®—ã€‚</p>
<p>è¿™åªæ˜¯æ‹¥æŠ±æ•°æ®æµå’ŒåŒæ­¥æ€ç»´çš„ç»“æœã€‚<strong>ç›¸åŒçš„è§£å†³æ–¹æ¡ˆé€‚ç”¨äºä»çˆ¶çº§ä¼ é€’çš„å‡½æ•°propsï¼š</strong> </p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ä½ çš„å…³æ³¨ç‚¹åœ¨è¿™é‡Œ</span>
  <span class="token comment">// âœ… Preserves identity until query changes</span>
  <span class="token keyword">const</span> fetchData <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span>
    <span class="token comment">// ... Fetch data and return it ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>query<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// âœ… Callback deps are OK</span>

  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">fetchData</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>fetchData<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token punctuation">{</span> fetchData <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>setData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>fetchData<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… Effect deps are OK</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç”±äº<code class="language-text">fetchData</code>åªåœ¨<code class="language-text">query</code>çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶æ‰ä¼šåœ¨<code class="language-text">Parent</code>å†…éƒ¨å‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„<code class="language-text">Child</code>åœ¨åº”ç”¨ç¨‹åºçœŸæ­£éœ€è¦æ—¶æ‰ä¼šé‡æ–°è·å–æ•°æ®ã€‚</p>
<h2 id="å‡½æ•°æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†å—ï¼Ÿ"><a href="#%E5%87%BD%E6%95%B0%E6%98%AF%E6%95%B0%E6%8D%AE%E6%B5%81%E7%9A%84%E4%B8%80%E9%83%A8%E5%88%86%E5%90%97%EF%BC%9F" aria-label="å‡½æ•°æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†å—ï¼Ÿ permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>å‡½æ•°æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†å—ï¼Ÿ</h2>
<p>æœ‰è¶£çš„æ˜¯ï¼Œç”¨ç±»æ‰“ç ´äº†è¿™ç§æ¨¡å¼ï¼ŒçœŸæ­£æ˜¾ç¤ºäº†æ•ˆæœå’Œç”Ÿå‘½å‘¨æœŸèŒƒä¾‹ä¹‹é—´çš„å·®å¼‚ã€‚è€ƒè™‘ä¸€ä¸‹è¿™ä¸ªè½¬æ¢:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    query<span class="token punctuation">:</span> <span class="token string">'react'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// ä½ çš„å…³æ³¨ç‚¹åœ¨è¿™é‡Œ(æ‰‹åŠ¨é«˜äº®)</span>
  <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
    <span class="token comment">// ... Fetch data and do something ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">fetchData</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>fetchData<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ä½ å¯èƒ½ä¼šæƒ³ï¼šâ€œå¾—äº†å§ï¼ŒDanï¼Œæˆ‘ä»¬éƒ½çŸ¥é“<code class="language-text">useEffect</code>å°±åƒ<code class="language-text">componentDidMount</code>å’Œ<code class="language-text">componentDidUpdate</code>ç»“åˆåœ¨ä¸€èµ·ï¼Œä½ æ— æ³•ç»§ç»­å†æ‘‡æ——å‘å–Šäº†ï¼â€ <strong>ç„¶è€Œï¼Œå³ä½¿ä½¿ç”¨<code class="language-text">componentDidUpdate</code>ï¼Œè¿™ä¹Ÿä¸èµ·ä½œç”¨ï¼š</strong> </p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ğŸ”´ This condition will never be true</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>fetchData <span class="token operator">!==</span> prevProps<span class="token punctuation">.</span>fetchData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å½“ç„¶ï¼Œ<code class="language-text">fetchData</code>æ˜¯ä¸€ä¸ªç±»çš„æ–¹æ³•ï¼(æˆ–è€…ï¼Œæ›´ç¡®åˆ‡åœ°è¯´ï¼Œä¸€ä¸ªç±»å±æ€§â€”â€”ä½†è¿™ä¸ä¼šæ”¹å˜ä»»ä½•ä¸œè¥¿ã€‚)ç”±äºçŠ¶æ€çš„å˜åŒ–ï¼Œå®ƒä¸ä¼šæœ‰æ‰€ä¸åŒã€‚æ‰€ä»¥<code class="language-text">this.props.fetchData</code>å°†ä¿æŒç­‰äº<code class="language-text">prevProps.fetchData</code>ï¼Œæˆ‘ä»¬å°†æ°¸è¿œä¸ä¼šé‡æ–°è·å–ã€‚è®©æˆ‘ä»¬åˆ é™¤è¿™ä¸ªæ¡ä»¶å‘¢ï¼Ÿ</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å“¦ç­‰ç­‰ï¼Œè¿™ä¼šåœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶è·å–ã€‚(åœ¨ä¸Šé¢çš„æ ‘ä¸­æ·»åŠ ä¸€ä¸ªåŠ¨ç”»æ˜¯å‘ç°å®ƒçš„ä¸€ç§æœ‰è¶£çš„æ–¹å¼ã€‚) ä¹Ÿè®¸è®©æˆ‘ä»¬å°†å®ƒç»‘å®šåˆ°ç‰¹å®šçš„æŸ¥è¯¢ï¼Ÿ</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">fetchData</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>fetchData<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ä½†æ˜¯ï¼Œå³ä½¿<code class="language-text">query</code>æ²¡æœ‰æ”¹å˜ï¼Œ<code class="language-text">this.props.fetchDataï¼== prevProps.fetchData</code>ä¹Ÿ<em>å§‹ç»ˆ</em> ä¸º<code class="language-text">true</code>ï¼æ‰€ä»¥æˆ‘ä»¬æ€»æ˜¯ä¼šé‡æ–°è·å–ã€‚</p>
<p>å¯¹äºç±»çš„è¿™ä¸ªéš¾é¢˜ï¼ŒæƒŸä¸€çœŸæ­£çš„è§£å†³æ–¹æ¡ˆæ˜¯å’¬ç´§ç‰™å…³ï¼Œå°†<code class="language-text">query</code>æœ¬èº«ä¼ é€’ç»™<code class="language-text">Child</code>ç»„ä»¶ã€‚<code class="language-text">Child</code>å®é™…ä¸Šå¹¶æ²¡æœ‰æœ€ç»ˆä½¿ç”¨<code class="language-text">query</code>ï¼Œä½†å®ƒå¯ä»¥åœ¨æ›´æ”¹æ—¶è§¦å‘é‡æ–°è·å–ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    query<span class="token punctuation">:</span> <span class="token string">'react'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
    <span class="token comment">// ... Fetch data and do something ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">fetchData</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>fetchData<span class="token punctuation">}</span></span> <span class="token attr-name">query</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>query<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>query <span class="token operator">!==</span> prevProps<span class="token punctuation">.</span>query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>åœ¨å¤šå¹´ä½¿ç”¨Reactç±»çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘å·²ç»ä¹ æƒ¯äº†ä¼ é€’ä¸å¿…è¦çš„propså¹¶ç ´åçˆ¶ç»„ä»¶çš„å°è£…ï¼Œç›´åˆ°ä¸€å‘¨å‰æˆ‘æ‰æ„è¯†åˆ°ä¸ºä»€ä¹ˆå¿…é¡»è¿™æ ·åšã€‚</p>
<p><strong>å¯¹äºç±»ï¼Œå‡½æ•°propsæœ¬èº«å¹¶ä¸æ˜¯æ•°æ®æµçš„çœŸæ­£ç»„æˆéƒ¨åˆ†ã€‚</strong> æ–¹æ³•è¿‡äºç´§å¯†äºå¯å˜çš„<code class="language-text">this</code>å˜é‡ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸èƒ½ä¾èµ–å®ƒä»¬çš„æ ‡è¯†æ¥è¡¨ç¤ºä»»ä½•å†…å®¹ã€‚ å› æ­¤ï¼Œå³ä½¿æˆ‘ä»¬åªæƒ³è¦ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»ä¼ é€’ä¸€å †å…¶ä»–æ•°æ®ï¼Œä»¥ä¾¿èƒ½å¤Ÿâ€œåŒºåˆ†â€å®ƒã€‚æˆ‘ä»¬æ— æ³•çŸ¥é“ä»çˆ¶çº§ä¼ é€’çš„<code class="language-text">this.props.fetchData</code>æ˜¯å¦ä¾èµ–äºæŸç§çŠ¶æ€ï¼Œä»¥åŠè¯¥çŠ¶æ€æ˜¯å¦åˆšåˆšæ›´æ”¹ã€‚</p>
<p><strong>ä½¿ç”¨<code class="language-text">useCallback</code>ï¼Œå‡½æ•°å¯ä»¥å®Œå…¨å‚ä¸æ•°æ®æµã€‚</strong> æˆ‘ä»¬å¯ä»¥è¯´ï¼Œå¦‚æœå‡½æ•°è¾“å…¥å‘ç”Ÿäº†å˜åŒ–ï¼Œå‡½æ•°æœ¬èº«å°±ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†å¦‚æœæ²¡æœ‰å˜åŒ–ï¼Œå®ƒå°±ä¼šä¿æŒä¸å˜ã€‚ç”±äº<code class="language-text">useCallback</code>æä¾›çš„ç²’åº¦ï¼Œå¯¹<code class="language-text">props.fetchData</code>ç­‰propsçš„æ›´æ”¹å¯ä»¥è‡ªåŠ¨å‘ä¸‹ä¼ æ’­ã€‚ </p>
<p>åŒæ ·ï¼Œ<a href="https://github.com/xiaohesong/TIL/blob/master/front-end/react/hooks/hooks-api.md#usememo" target="_blank" rel="nofollow noopener noreferrer">useMemo</a>è®©æˆ‘ä»¬å¯¹å¤æ‚å¯¹è±¡ä¹Ÿè¿™æ ·åšï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">ColorPicker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Doesn't break Child's shallow equality prop check</span>
  <span class="token comment">// unless the color actually changes.</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>color<span class="token punctuation">,</span> setColor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'pink'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> style <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> color <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>color<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>style<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>æˆ‘æƒ³å¼ºè°ƒçš„æ˜¯ï¼Œåœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨<code class="language-text">useCallback</code>éƒ½éå¸¸ç¬¨é‡ã€‚</strong> å½“ä¸€ä¸ªå‡½æ•°ä¼ é€’ä¸‹å»å¹¶ä»ä¸€äº›å­ç»„ä»¶çš„æ•ˆæœå†…éƒ¨è°ƒç”¨æ—¶å®ƒå¾ˆæœ‰ç”¨ã€‚æˆ–è€…ï¼Œå¦‚æœä½ è¯•å›¾é˜»æ­¢ç ´åå­ç»„ä»¶çš„è®°å¿†ã€‚ä½†Hooksæ›´é€‚åˆäº<a href="https://reactjs.org/docs/hooks-faq.html#how-to-avoid-passing-callbacks-down" target="_blank" rel="nofollow noopener noreferrer">é¿å…å›è°ƒå®Œå…¨ä¼ é€’ä¸‹æ¥</a>ã€‚</p>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘æ›´å¸Œæœ›<code class="language-text">fetchData</code>ä½äºæˆ‘çš„effect(å®ƒæœ¬èº«å¯ä»¥è¢«æå–åˆ°ä¸€ä¸ªè‡ªå®šä¹‰çš„é’©å­ä¸­)æˆ–é¡¶å±‚å¯¼å…¥ä¸­ã€‚æˆ‘å¸Œæœ›ä¿æŒeffectç®€å•ï¼Œå¹¶ä¸”å…¶ä¸­çš„å›è°ƒå¯¹æ­¤æ²¡æœ‰å¸®åŠ©ã€‚(â€œå¦‚æœåœ¨è¯·æ±‚è¿è¡ŒæœŸé—´æŸäº›<code class="language-text">props.onComplete</code>å›è°ƒå‘ç”Ÿäº†æ›´æ”¹ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿâ€) ä½ å¯ä»¥<a href="https://overreacted.io/a-complete-guide-to-useeffect/#swimming-against-the-tide" target="_blank" rel="nofollow noopener noreferrer">æ¨¡æ‹Ÿç±»è¡Œä¸º</a>ï¼Œä½†è¿™å¹¶ä¸èƒ½è§£å†³ç«äº‰æ¡ä»¶ã€‚</p>
<h2 id="è¯´è¯´ç«äº‰æ¡ä»¶"><a href="#%E8%AF%B4%E8%AF%B4%E7%AB%9E%E4%BA%89%E6%9D%A1%E4%BB%B6" aria-label="è¯´è¯´ç«äº‰æ¡ä»¶ permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>è¯´è¯´ç«äº‰æ¡ä»¶</h2>
<p>ä½¿ç”¨ç±»çš„ç»å…¸æ•°æ®è·å–ç¤ºä¾‹å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Article</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    article<span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">async</span> <span class="token function">fetchData</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> article <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token constant">API</span><span class="token punctuation">.</span><span class="token function">fetchArticle</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> article <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ä½ å¯èƒ½çŸ¥é“ï¼Œè¿™æ®µä»£ç æœ‰äº›é—®é¢˜ã€‚å®ƒä¸å¤„ç†æ›´æ–°ã€‚æ‰€ä»¥ä½ å¯ä»¥åœ¨ç½‘ä¸Šæ‰¾åˆ°çš„ç¬¬äºŒä¸ªç»å…¸ä¾‹å­æ˜¯è¿™æ ·çš„ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Article</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    article<span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>prevProps<span class="token punctuation">.</span>id <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">async</span> <span class="token function">fetchData</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> article <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token constant">API</span><span class="token punctuation">.</span><span class="token function">fetchArticle</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> article <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>è¿™è‚¯å®šæ›´å¥½ï¼ä½†ä»–ä»ç„¶æœ‰äº›é—®é¢˜ã€‚å®ƒæœ‰é—®é¢˜çš„åŸå› æ˜¯è¯·æ±‚é¡ºåºå¯èƒ½å‡ºç°é—®é¢˜ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘æ­£åœ¨è·å–<code class="language-text">{idï¼š10}</code>çš„æ•°æ®ï¼Œåˆ‡æ¢åˆ°<code class="language-text">{idï¼š20}</code>ï¼Œä½†<code class="language-text">{idï¼š20}</code>è¯·æ±‚é¦–å…ˆå‡ºç°ï¼Œå…ˆå‰å¼€å§‹ä½†ç¨åå®Œæˆçš„è¯·æ±‚å°†é”™è¯¯åœ°è¦†ç›–æˆ‘çš„çŠ¶æ€ã€‚</p>
<p>è¿™è¢«ç§°ä¸ºç«äº‰æ¡ä»¶ï¼Œå®ƒåœ¨ä»£ç ä¸­æ˜¯å…¸å‹çš„ï¼Œå°†<code class="language-text">async</code>/<code class="language-text">await</code>ï¼ˆå‡å®šæœ‰ä¸œè¥¿åœ¨ç­‰å¾…ç»“æœï¼‰ä¸è‡ªé¡¶å‘ä¸‹çš„æ•°æ®æµï¼ˆå½“æˆ‘ä»¬å¤„äºå¼‚æ­¥å‡½æ•°çš„ä¸­é—´æ—¶ï¼Œå±æ€§æˆ–çŠ¶æ€å¯èƒ½ä¼šæ”¹å˜ï¼‰æ··åˆåœ¨ä¸€èµ·ã€‚</p>
<p>æ•ˆæœå¹¶ä¸èƒ½ç¥å¥‡åœ°è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœä½ è¯•å›¾å°†<code class="language-text">async</code>å‡½æ•°ç›´æ¥ä¼ é€’ç»™æ•ˆæœï¼Œå®ƒä»¬ä¼šè­¦å‘Šä½ ã€‚(æˆ‘ä»¬éœ€è¦æ”¹è¿›è¿™ä¸ªè­¦å‘Šï¼Œä»¥ä¾¿æ›´å¥½åœ°è§£é‡Šä½ å¯èƒ½é‡åˆ°çš„é—®é¢˜ã€‚)</p>
<p>å¦‚æœä½ ä½¿ç”¨çš„å¼‚æ­¥æ–¹æ³•æ”¯æŒå–æ¶ˆï¼Œé‚£å°±å¤ªæ£’äº†! ä½ å¯ä»¥åœ¨æ¸…ç†å‡½æ•°ä¸­å–æ¶ˆå¼‚æ­¥è¯·æ±‚ã€‚</p>
<p>æˆ–è€…ï¼Œæœ€ç®€å•çš„æƒå®œä¹‹è®¡æ–¹æ³•æ˜¯ä½¿ç”¨å¸ƒå°”å€¼è·Ÿè¸ªå®ƒï¼š</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Article</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>article<span class="token punctuation">,</span> setArticle<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">let</span> didCancel <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>    <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> article <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token constant">API</span><span class="token punctuation">.</span><span class="token function">fetchArticle</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>didCancel<span class="token punctuation">)</span> <span class="token punctuation">{</span>        </span>      	<span class="token function">setArticle</span><span class="token punctuation">(</span>article<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// è¿™é‡Œä¹Ÿæ˜¯ä½ çš„å…³æ³¨ç‚¹</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>      
    	didCancel <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span><span class="token punctuation">;</span>  
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p><a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="nofollow noopener noreferrer">è¿™ç¯‡æ–‡ç« </a>è¯¦ç»†ä»‹ç»äº†å¦‚ä½•å¤„ç†é”™è¯¯å’ŒåŠ è½½çŠ¶æ€ï¼Œä»¥åŠå°†è¯¥é€»è¾‘æå–åˆ°è‡ªå®šä¹‰Hookä¸­ã€‚å¦‚æœä½ æœ‰å…´è¶£äº†è§£æœ‰å…³ä½¿ç”¨Hooksè·å–æ•°æ®çš„æ›´å¤šä¿¡æ¯ï¼Œæˆ‘å»ºè®®ä½ æŸ¥çœ‹ä¸€ä¸‹ã€‚</p>
<h2 id="æé«˜æ ‡å‡†"><a href="#%E6%8F%90%E9%AB%98%E6%A0%87%E5%87%86" aria-label="æé«˜æ ‡å‡† permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æé«˜æ ‡å‡†</h2>
<p>ä½¿ç”¨ç±»ç”Ÿå‘½å‘¨æœŸæ€ç»´æ¨¡å¼ï¼Œå‰¯ä½œç”¨ä¸æ¸²æŸ“è¾“å‡ºçš„è¡Œä¸ºä¸åŒã€‚æ¸²æŸ“UIç”±propså’Œstateé©±åŠ¨ï¼Œå¹¶ä¿è¯ä¸å®ƒä»¬ä¸€è‡´ï¼Œä½†å‰¯ä½œç”¨ä¸æ˜¯ã€‚è¿™æ˜¯bugçš„å¸¸è§æ¥æºã€‚</p>
<p>ä½¿ç”¨<code class="language-text">useEffect</code>çš„æ€ç»´æ¨¡å¼ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šåŒæ­¥äº‹ç‰©ã€‚å‰¯ä½œç”¨æˆä¸ºReactæ•°æ®æµçš„ä¸€éƒ¨åˆ†ã€‚å¯¹äºæ¯ä¸ª<code class="language-text">useEffect</code>è°ƒç”¨ï¼Œä¸€æ—¦ä½ åšå¯¹äº†ï¼Œä½ çš„ç»„ä»¶å°±ä¼šæ›´å¥½åœ°å¤„ç†è¾¹ç¼˜æƒ…å†µã€‚</p>
<p>ç„¶è€Œï¼Œåšå¥½è¿™ä»¶äº‹çš„å‰æœŸæˆæœ¬æ›´é«˜ã€‚è¿™å¯èƒ½å¾ˆçƒ¦äººã€‚ç¼–å†™èƒ½å¤Ÿå¾ˆå¥½åœ°å¤„ç†è¾¹ç¼˜æƒ…å†µçš„åŒæ­¥ä»£ç ï¼Œæœ¬è´¨ä¸Šæ¯”å¼•å‘ä¸æ¸²æŸ“ä¸ä¸€è‡´çš„ä¸€æ¬¡æ€§å‰¯ä½œç”¨æ›´å›°éš¾ã€‚</p>
<p>å¦‚æœ<code class="language-text">useEffect</code>æ˜¯ä½ å¤§å¤šæ•°æ—¶é—´ä½¿ç”¨çš„å·¥å…·ï¼Œè¿™å¯èƒ½ä¼šä»¤äººæ‹…å¿§ã€‚ç„¶è€Œï¼Œå®ƒæ˜¯ä¸€ä¸ªä½å±‚çš„æ„å»ºå—ã€‚ç°åœ¨æ˜¯ä½¿ç”¨é’©å­çš„æ—©æœŸé˜¶æ®µï¼Œæ‰€ä»¥æ¯ä¸ªäººéƒ½ä¸€ç›´åœ¨ä½¿ç”¨ä½çº§åˆ«çš„é’©å­ï¼Œå°¤å…¶æ˜¯åœ¨æ•™ç¨‹ä¸­ã€‚ä½†æ˜¯åœ¨å®è·µä¸­ï¼Œéšç€å¥½çš„APIè·å¾—å‘å±•åŠ¿å¤´ï¼Œç¤¾åŒºå¾ˆå¯èƒ½ä¼šå¼€å§‹è½¬å‘æ›´é«˜çº§åˆ«çš„é’©å­ã€‚</p>
<p>æˆ‘çœ‹åˆ°ä¸åŒçš„åº”ç”¨ç¨‹åºåˆ›å»ºäº†å®ƒä»¬è‡ªå·±çš„é’©å­ï¼Œæ¯”å¦‚å°è£…äº†å®ƒä»¬çš„ä¸€äº›åº”ç”¨ç¨‹åºçš„authé€»è¾‘çš„<code class="language-text">useFetch</code>æˆ–ä½¿ç”¨ä¸»é¢˜ä¸Šä¸‹æ–‡çš„<code class="language-text">useTheme</code>ã€‚ä¸€æ—¦ä½ æœ‰äº†è¿™äº›å·¥å…·ç®±ï¼Œä½ å°±ä¸ä¼šç»å¸¸ä½¿ç”¨<code class="language-text">useEffect</code>ã€‚ä½†å®ƒå¸¦æ¥çš„å¼¹æ€§ä½¿æ¯ä¸ªHookéƒ½èƒ½åœ¨å…¶ä¸Šæ„å»ºã€‚</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œ<code class="language-text">useEffect</code>æœ€å¸¸ç”¨äºæ•°æ®è·å–ã€‚ä½†æ˜¯æ•°æ®æå–å¹¶ä¸æ˜¯ä¸€ä¸ªåŒæ­¥é—®é¢˜ã€‚è¿™ä¸€ç‚¹å°¤å…¶æ˜æ˜¾ï¼Œå› ä¸ºæˆ‘ä»¬çš„depsç»å¸¸æ˜¯<code class="language-text">[]</code>ã€‚æˆ‘ä»¬åœ¨åŒæ­¥ä»€ä¹ˆ?</p>
<p>ä»é•¿è¿œæ¥çœ‹ï¼Œ<a href="https://reactjs.org/blog/2018/11/27/react-16-roadmap.html#react-16x-mid-2019-the-one-with-suspense-for-data-fetching" target="_blank" rel="nofollow noopener noreferrer">æ•°æ®è·å–çš„suspense</a>å°†å…è®¸ç¬¬ä¸‰æ–¹åº“ä»¥ä¸€ç§ä¸€æµçš„æ–¹å¼å‘Šè¯‰Reactæš‚åœæ¸²æŸ“ï¼Œç›´åˆ°å¼‚æ­¥(ä»»ä½•ä¸œè¥¿:ä»£ç ã€æ•°æ®ã€å›¾åƒ)å°±ç»ªã€‚</p>
<p>éšç€suspenseé€æ¸è¦†ç›–æ›´å¤šçš„æ•°æ®è·å–ç”¨ä¾‹ï¼Œæˆ‘é¢„è®¡å½“ä½ çœŸæ­£æƒ³è¦åŒæ­¥propså’ŒçŠ¶æ€åˆ°æŸä¸ªå‰¯ä½œç”¨æ—¶ï¼Œ<code class="language-text">useEffect</code>å°†ä½œä¸ºä¸€ä¸ªé«˜çº§ç”¨æˆ·å·¥å…·æ·¡å‡ºèƒŒæ™¯ã€‚ä¸æ•°æ®è·å–ä¸åŒï¼Œå®ƒå¯ä»¥å¾ˆè‡ªç„¶åœ°å¤„ç†è¿™ç§æƒ…å†µï¼Œå› ä¸ºå®ƒæ˜¯ä¸ºè¿™ç§æƒ…å†µè€Œè®¾è®¡çš„ã€‚ä½†åœ¨æ­¤ä¹‹å‰ï¼Œ<a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="nofollow noopener noreferrer">è¿™é‡Œæ‰€ç¤º</a>çš„è‡ªå®šä¹‰é’©å­æ˜¯é‡ç”¨æ•°æ®è·å–é€»è¾‘çš„å¥½æ–¹æ³•ã€‚</p>
<h2 id="ç»“æŸ"><a href="#%E7%BB%93%E6%9D%9F" aria-label="ç»“æŸ permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ç»“æŸ</h2>
<p>ç°åœ¨ä½ å·²ç»äº†è§£äº†æˆ‘ä½¿ç”¨æ•ˆæœçš„æ‰€æœ‰çŸ¥è¯†ï¼Œè¯·åœ¨å¼€å§‹æ—¶æŸ¥çœ‹<a href="#tldr">TLDR</a>ã€‚æœ‰æ„ä¹‰å—?æˆ‘é”™è¿‡ä»€ä¹ˆäº†å—?(æˆ‘çš„çº¸è¿˜æ²¡æœ‰ç”¨å®Œå‘¢!)</p>
<p>æˆ‘å¾ˆæƒ³åœ¨<a href="https://mobile.twitter.com/search?q=https%3A%2F%2Foverreacted.io%2Fa-complete-guide-to-useeffect%2F" target="_blank" rel="nofollow noopener noreferrer">Twitter</a>ä¸Šæ”¶åˆ°ä½ çš„æ¥ä¿¡ï¼è°¢è°¢é˜…è¯»ã€‚</p>
<h2 id="ç¬”è€…ä¸ªäººæ€»ç»“"><a href="#%E7%AC%94%E8%80%85%E4%B8%AA%E4%BA%BA%E6%80%BB%E7%BB%93" aria-label="ç¬”è€…ä¸ªäººæ€»ç»“ permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ç¬”è€…ä¸ªäººæ€»ç»“</h2>
<p>å…¶å®è¿™ä¸ªå°±åƒå‰é¢æ‰€è¯´çš„ç±»å’Œå‡½æ•°çš„åŒºåˆ«äº†ã€‚å› ä¸ºåœ¨Reactä¸­ï¼Œpropsæ˜¯ä¸ä¼šæ”¹å˜çš„ï¼Œè€Œthis(state)æ˜¯å¯å˜çš„ã€‚æ‰€ä»¥é€ æˆäº†æ”¹å˜ã€‚ç”±äºpropsæ˜¯ä¸å¯å˜çš„ï¼Œè¿™æ ·é’ˆå¯¹æ¯æ¬¡çš„æ¸²æŸ“ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªç‰¹å®šçš„æ¸²æŸ“(æ¯æ¬¡çš„æ¸²æŸ“)ã€‚</p>
<p>å¯¹äºeffectå†…ä½¿ç”¨çš„å‡½æ•°ï¼Œæœ€å¥½æ˜¯æ”¾åœ¨effectä¸­ï¼Œè¿™æ ·å¯ä»¥é¿å…ä»¥åç»„ä»¶å¢åŠ è€Œæœªå¤„ç†æ‰€æœ‰çš„æƒ…å†µã€‚å¦‚æœæœ‰å¤ç”¨ï¼Œå¯ä»¥æŠŠè¿™äº›å‡½æ•°æåˆ°effectå¤–é¢ï¼Œä½¿ç”¨useCallbackåŒ…è£¹èµ·æ¥ã€‚</p></div><hr style="margin-bottom:1.75rem"/><div id="gitalk-container"></div><div style="display:flex;margin-bottom:4.375rem"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px;margin-right:0.875rem;margin-bottom:0;min-width:50px;border-radius:100%"><img src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAMBBAX/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAfV2VMTpa1Z0DBX/xAAcEAACAgIDAAAAAAAAAAAAAAABAgADEBIRE0L/2gAIAQEAAQUC7BzXbsJoFb1CobP/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAWEQADAAAAAAAAAAAAAAAAAAABESD/2gAIAQIBAT8BZj//xAAaEAACAgMAAAAAAAAAAAAAAAABEAARISIx/9oACAEBAAY/AuvIg1NKy//EABoQAQEBAAMBAAAAAAAAAAAAAAERABAhQVH/2gAIAQEAAT8hWmijJpC+3DTX1mdifMV67xw+D2cXf//aAAwDAQACAAMAAAAQg+eA/8QAFxEBAAMAAAAAAAAAAAAAAAAAEQEgIf/aAAgBAwEBPxCF2n//xAAZEQACAwEAAAAAAAAAAAAAAAABEQAQIWH/2gAIAQIBAT8Qy7A1sQFf/8QAHhABAAIDAAIDAAAAAAAAAAAAAQARITFREGFBkaH/2gAIAQEAAT8QEuyCDId9zp2C/T+9+4NktKw5LJ12GuD+RW9ryAABoltHBhSzj4WLP//Z" alt="xiaohesong" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition:opacity 0.5s;transition-delay:0.25s;border-radius:50%"/><noscript><picture><img width="50" height="50" srcset="/static/07e30cd3712feafff1061a78433576ec/7e494/profile-pic.jpg 1x,
/static/07e30cd3712feafff1061a78433576ec/36cc2/profile-pic.jpg 1.5x,
/static/07e30cd3712feafff1061a78433576ec/0a3a6/profile-pic.jpg 2x,
/static/07e30cd3712feafff1061a78433576ec/75d16/profile-pic.jpg 3x" src="/static/07e30cd3712feafff1061a78433576ec/7e494/profile-pic.jpg" alt="xiaohesong" style="position:absolute;top:0;left:0;transition:opacity 0.5s;transition-delay:0.5s;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p> <!-- -->æœ¬åšå®¢æ˜¯<a href="https://github.com/xiaohesong/til"> <!-- -->æ­¤å­¦ä¹ åº“</a> <!-- -->çš„éƒ¨åˆ†å†…å®¹ã€‚<!-- --> <!-- -->ä½ ä¹Ÿå¯ä»¥ç‚¹å‡»æŸ¥çœ‹<a href="http://xiaohesong.github.io"> <!-- -->æœªè¿ç§»çš„è€åšå®¢</a>ã€‚<!-- --> </p></div><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/hi-folks/">â† <!-- -->ç¼–å†™å¯ä¼¸ç¼©ç»„ä»¶</a></li><li></li></ul></main><footer><a href="https://mobile.twitter.com/xiaohesong" target="_blank" rel="noopener noreferrer">twitter</a> <!-- -->â€¢<!-- --> <a href="https://github.com/xiaohesong" target="_blank" rel="noopener noreferrer">github</a></footer></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'undefined', 'auto', {});
      
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"complete-effects-a30","path":"/complete-effects/"};window.dataPath="981/path---complete-effects-a-30-eec-QSOVuHO2ZAG6i2S7DoHCPiVsesI";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-2d0306e8e3d3d5f3a6aa.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-f81cbe66c06371c7b55a.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-96d8df3c717df691c5f4.js"],"component---src-pages-404-js":["/component---src-pages-404-js-92f54b44b2ec6634d92b.js"],"component---src-pages-index-js":["/component---src-pages-index-js-b1aa205f77c538612fb7.js"],"pages-manifest":["/pages-manifest-7227f5cf08175af71858.js"]};/*]]>*/</script><script src="/webpack-runtime-7cce248b055c448b772c.js" async=""></script><script src="/app-2d0306e8e3d3d5f3a6aa.js" async=""></script><script src="/1-1e22823bb50faf851faf.js" async=""></script><script src="/9-4a5ba2240e899672ff06.js" async=""></script><script src="/component---src-templates-blog-post-js-96d8df3c717df691c5f4.js" async=""></script><script src="/styles-60fd549bc9ab6b221310.js" async=""></script></body></html>